var Tn=Object.defineProperty;var Rn=(g,t,e)=>t in g?Tn(g,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[t]=e;var G=(g,t,e)=>(Rn(g,typeof t!="symbol"?t+"":t,e),e),Sn=(g,t,e)=>{if(!t.has(g))throw TypeError("Cannot "+e)};var St=(g,t,e)=>{if(t.has(g))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(g):t.set(g,e)};var kt=(g,t,e)=>(Sn(g,t,"access private method"),e);import{cp as je,dz as Dt,cq as w,d1 as Ve,cr as ne,cu as y,cx as A,cF as B,cA as _,cz as f,cK as te,cJ as H,cE as de,cZ as Fe,cy as Q,cB as m,cH as U,dE as lt,cN as q,dI as he,cG as Pt,cC as It,cU as Ge,cv as ce,cV as dt,d3 as cn,ct as ft,cw as Ye,dJ as Xe,cY as un,dh as Me,cR as Mt,Q as rt,d0 as zn,dK as In,dL as En,dM as Ln,dN as Dn,dO as en,dP as Pn,dQ as Mn,dR as tn,dA as Bn,dS as Hn,dT as qn,dU as On,dV as Fn,dW as nn,dX as se,dY as jn,dZ as pn,d_ as zt,dD as Vn,d$ as Un,e0 as Zn}from"./index-07dfdb25.js";const Nn=Object.freeze(Object.defineProperty({__proto__:null,get default(){return Ia}},Symbol.toStringTag,{value:"Module"})),Qn=je({__name:"password",props:{applicationProfile:{},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(g,{emit:t}){const e=Dt(),n=w(),{params:{accessToken:a}}=e,{application:o}=Ve(),l=g,i=w(!1),u=ne(()=>l.applicationProfile?l.modelValue?!1:l.applicationProfile.authentication:!1),r=t,p=()=>o.asyncAppAuthentication(a,i,b.value).then(()=>{r("update:modelValue",!0)}),v=(x,E,R)=>{E===""?R(new Error(Fe("chat.passwordValidator.errorMessage1"))):p().catch(()=>{R(new Error(Fe("chat.passwordValidator.errorMessage2")))})},c=()=>{n.value.validate()},s={value:[{required:!0,validator:v,trigger:"manual"}]},b=w({type:"password",value:""});return(x,E)=>{const R=y("el-input"),S=y("el-form-item"),P=y("el-button"),Z=y("el-form"),X=y("el-dialog");return A(),B(X,{modelValue:u.value,"modal-class":"positioned-mask",width:"300",title:x.$t("chat.passwordValidator.title"),"custom-class":"no-close-button","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,top:"25vh",center:"",modal:!0},{default:_(()=>[f(Z,{ref_key:"FormRef",ref:n,model:b.value,onSubmit:de(c,["prevent"])},{default:_(()=>[f(S,{prop:"value",rules:s.value},{default:_(()=>[f(R,{"show-password":"",modelValue:b.value.value,"onUpdate:modelValue":E[0]||(E[0]=ie=>b.value.value=ie)},null,8,["modelValue"])]),_:1},8,["rules"]),f(P,{class:"w-full mt-8",type:"primary",onClick:c,loading:i.value},{default:_(()=>[te(H(x.$t("common.confirm")),1)]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});const Wn=Object.freeze(Object.defineProperty({__proto__:null,default:Qn},Symbol.toStringTag,{value:"Module"})),Gn={class:"flex align-center"},Yn={class:"mr-12 ml-24 flex"},Xn=["src"],dn=je({__name:"index",props:{modelValue:{type:Boolean},application_profile:{},auth_type:{default:"password"},style:{default:{}}},emits:["update:modelValue"],setup(g,{emit:t}){const e=Object.assign({"/src/views/chat/auth/component/password.vue":Wn}),n=t,a=g,o=ne({get:()=>a.modelValue,set:i=>{n("update:modelValue",i)}}),l=ne(()=>{var i,u,r,p;return{background:(u=(i=a.application_profile)==null?void 0:i.custom_theme)==null?void 0:u.theme_color,color:(p=(r=a.application_profile)==null?void 0:r.custom_theme)==null?void 0:p.header_font_color,border:"none",...a.style}});return(i,u)=>{var p,v,c,s;const r=y("AppAvatar");return A(),Q(It,null,[m("div",{class:"chat-pc__header",style:he(l.value)},[m("div",Gn,[m("div",Yn,[U(lt)((p=i.application_profile)==null?void 0:p.icon)?(A(),B(r,{key:0,shape:"square",size:32,style:{background:"none"}},{default:_(()=>{var b;return[m("img",{src:(b=i.application_profile)==null?void 0:b.icon,alt:""},null,8,Xn)]}),_:1})):(v=i.application_profile)!=null&&v.name?(A(),B(r,{key:1,name:(c=i.application_profile)==null?void 0:c.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):q("",!0)]),m("h4",null,H((s=i.application_profile)==null?void 0:s.name),1)])],4),(A(),B(Pt(U(e)[`/src/views/chat/auth/component/${i.auth_type}.vue`].default),{modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=b=>o.value=b),applicationProfile:i.application_profile},null,8,["modelValue","applicationProfile"]))],64)}}}),Jn=Object.freeze(Object.defineProperty({__proto__:null,default:dn},Symbol.toStringTag,{value:"Module"})),Kn={class:"chat layout-bg"},el={class:"chat-width flex align-center"},tl={class:"mr-12 ml-24 flex"},nl=["src"],ll={class:"chat__main chat-width"},ol={class:"ml-4"},al=je({__name:"index",props:{application_profile:{},applicationAvailable:{type:Boolean}},setup(g){const{user:t}=Ve(),e=ne(()=>t.isDefaultTheme()),n=w(!1),a=g,o=ne({get:()=>a.application_profile,set:p=>{}}),l=w([]),i=w("");function u(){i.value="new",l.value=[]}function r(p){i.value=p}return(p,v)=>{var S,P,Z,X,ie;const c=y("AppAvatar"),s=y("Plus"),b=y("el-icon"),x=y("el-button"),E=y("AiChat"),R=Ge("loading");return ce((A(),Q("div",Kn,[m("div",{class:dt(["chat__header",e.value?"":"custom-header"])},[m("div",el,[m("div",tl,[U(lt)((S=o.value)==null?void 0:S.icon)?(A(),B(c,{key:0,shape:"square",size:32,style:{background:"none"}},{default:_(()=>{var Y;return[m("img",{src:(Y=o.value)==null?void 0:Y.icon,alt:""},null,8,nl)]}),_:1})):(P=o.value)!=null&&P.name?(A(),B(c,{key:1,name:(Z=o.value)==null?void 0:Z.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):q("",!0)]),m("h2",null,H((X=o.value)==null?void 0:X.name),1)])],2),m("div",ll,[f(E,{applicationDetails:o.value,"onUpdate:applicationDetails":v[0]||(v[0]=Y=>o.value=Y),type:"ai-chat",available:p.applicationAvailable,appId:(ie=o.value)==null?void 0:ie.id,record:l.value,chatId:i.value,onRefresh:r},{operateBefore:_(()=>[m("div",null,[f(x,{type:"primary",link:"",class:"new-chat-button mb-8",onClick:u},{default:_(()=>[f(b,null,{default:_(()=>[f(s)]),_:1}),m("span",ol,H(p.$t("chat.createChat")),1)]),_:1})])]),_:1},8,["applicationDetails","available","appId","record","chatId"])])])),[[R,n.value]])}}});const sl=Object.freeze(Object.defineProperty({__proto__:null,default:al},Symbol.toStringTag,{value:"Module"})),il={class:"flex align-center"},rl={class:"mr-12 ml-24 flex"},cl=["src"],ul={class:"chat-embed__main"},pl={class:"ml-4"},dl={class:"chat-popover w-full"},hl={class:"border-b p-16-24"},fl={class:"p-8"},_l={class:"flex-between"},ml={class:"text-center mt-24"},vl={key:0,class:"gradient-divider lighter mt-8"},gl={class:"chat-popover-mask"},kl=je({__name:"index",props:{application_profile:{},applicationAvailable:{type:Boolean}},setup(g){const{user:t,log:e}=Ve(),n=Dt(),a=ne(()=>n.query.popup!=="no"),o=w(),l=w(!1),i=w(!1),u=w([]),r=w(!1),p=g,v=ne({get:()=>p.application_profile,set:k=>{}}),c=cn({current_page:1,page_size:20,total:0}),s=w([]),b=w("new"),x=w(""),E=ne(()=>{var k,D,F,$;return{background:(D=(k=v.value)==null?void 0:k.custom_theme)==null?void 0:D.theme_color,color:($=(F=v.value)==null?void 0:F.custom_theme)==null?void 0:$.header_font_color}});function R(k,D){if(k){const F={abstract:k};e.asyncPutChatClientLog(v.value.id,D.id,F,l).then(()=>{const $=u.value.find(L=>L.id===D.id);$&&($.abstract=k),D.writeStatus=!1})}else un(Fe("views.applicationWorkflow.tip.nameMessage"))}function S(k){k.writeStatus=!0}function P(k){k.writeStatus=!1}function Z(k){x.value=k.id}function X(k){e.asyncDelChatClientLog(v.value.id,k.id,i).then(()=>{b.value===k.id&&(b.value="new",c.current_page=1,c.total=0,s.value=[]),le(v.value.id)})}function ie(k){if(b.value!=="new"&&k.scrollTop===0&&c.total>s.value.length){const D=k.dialogScrollbar.offsetHeight;c.current_page+=1,oe().then(()=>{k.scrollDiv.setScrollTop(k.dialogScrollbar.offsetHeight-D)})}}function Y(){r.value=!1}function ee(){c.current_page=1,s.value=[],b.value="new"}function le(k){const D={current_page:1,page_size:20};e.asyncGetChatLogClient(k,D,i).then(F=>{var $,L;u.value=F.data.records,c.current_page=1,c.total=0,s.value=[],b.value=((L=($=u.value)==null?void 0:$[0])==null?void 0:L.id)||"new",b.value!=="new"&&oe()})}function oe(){return e.asyncChatRecordLog(v.value.id,b.value,c,l,!1).then(k=>{c.total=k.data.total;const D=k.data.records;D.map(F=>{F.write_ed=!0,F.record_id=F.id}),s.value=[...D,...s.value].sort((F,$)=>F.create_time.localeCompare($.create_time)),c.current_page===1&&Me(()=>{o.value.setScrollBottom()})})}const ue=k=>{k.id!==b.value&&(c.current_page=1,s.value=[],b.value=k.id,b.value!=="new"&&oe(),r.value=!1)};function I(k){le(v.value.id),b.value=k}const O=()=>{(v.value.show_history||!t.isEnterprise())&&le(v.value.id)};return ft(()=>{O()}),(k,D)=>{var Te,Re,Se,qe,ze,Ie,Ee,Le,ve,pe,be;const F=y("AppAvatar"),$=y("Plus"),L=y("el-icon"),V=y("el-button"),J=y("AiChat"),ae=y("AppIcon"),xe=y("ReadWrite"),ke=y("EditPen"),$e=y("Delete"),Ce=y("el-text"),me=y("common-list"),Ue=y("el-scrollbar"),Ze=y("el-collapse-transition"),Ae=Ge("loading"),Ne=Ge("click-outside");return ce((A(),Q("div",{class:dt(["chat-embed layout-bg",{"chat-embed--popup":a.value}]),style:he({"--el-color-primary":(Re=(Te=v.value)==null?void 0:Te.custom_theme)==null?void 0:Re.theme_color,"--el-color-primary-light-9":U(Xe)((qe=(Se=v.value)==null?void 0:Se.custom_theme)==null?void 0:qe.theme_color,.1)})},[m("div",{class:"chat-embed__header",style:he(E.value)},[m("div",il,[m("div",rl,[U(lt)((ze=v.value)==null?void 0:ze.icon)?(A(),B(F,{key:0,shape:"square",size:32,style:{background:"none"}},{default:_(()=>{var W;return[m("img",{src:(W=v.value)==null?void 0:W.icon,alt:""},null,8,cl)]}),_:1})):(Ie=v.value)!=null&&Ie.name?(A(),B(F,{key:1,name:(Ee=v.value)==null?void 0:Ee.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):q("",!0)]),m("h4",null,H((Le=v.value)==null?void 0:Le.name),1)])],4),m("div",null,[m("div",ul,[f(J,{ref_key:"AiChatRef",ref:o,applicationDetails:v.value,"onUpdate:applicationDetails":D[0]||(D[0]=W=>v.value=W),available:k.applicationAvailable,appId:(ve=v.value)==null?void 0:ve.id,record:s.value,chatId:b.value,type:"ai-chat",onRefresh:I,onScroll:ie,class:"AiChat-embed"},{operateBefore:_(()=>[m("div",null,[f(V,{type:"primary",link:"",class:"new-chat-button mb-8",onClick:ee},{default:_(()=>[f(L,null,{default:_(()=>[f($)]),_:1}),m("span",pl,H(k.$t("chat.createChat")),1)]),_:1})])]),_:1},8,["applicationDetails","available","appId","record","chatId"])]),v.value.show_history||!U(t).isEnterprise()?(A(),Q("div",{key:0,onClick:D[1]||(D[1]=de(W=>r.value=!r.value,["prevent","stop"])),class:"chat-popover-button cursor color-secondary"},[f(ae,{iconName:"app-history-outlined",style:he({color:(be=(pe=v.value)==null?void 0:pe.custom_theme)==null?void 0:be.header_font_color})},null,8,["style"])])):q("",!0),f(Ze,null,{default:_(()=>[ce((A(),Q("div",dl,[m("div",hl,[m("span",null,H(k.$t("chat.history")),1)]),f(Ue,{"max-height":"300"},{default:_(()=>{var W,ye;return[m("div",fl,[ce((A(),B(me,{style:he({"--el-color-primary":(ye=(W=v.value)==null?void 0:W.custom_theme)==null?void 0:ye.theme_color}),data:u.value,defaultActive:b.value,onClick:ue,onMouseenter:Z,onMouseleave:D[3]||(D[3]=d=>x.value="")},{default:_(({row:d})=>[m("div",_l,[f(xe,{onChange:h=>R(h,d),data:d.abstract,trigger:"manual",write:d.writeStatus,onClose:h=>P(d),maxlength:1024},null,8,["onChange","data","write","onClose"]),x.value===d.id&&d.id!=="new"&&!d.writeStatus?(A(),Q("div",{key:0,onClick:D[2]||(D[2]=de(()=>{},["stop"])),class:"flex"},[f(V,{style:{padding:"0"},link:"",onClick:de(h=>S(d),["stop"])},{default:_(()=>[f(L,null,{default:_(()=>[f(ke)]),_:1})]),_:2},1032,["onClick"]),f(V,{style:{padding:"0"},link:"",onClick:de(h=>X(d),["stop"])},{default:_(()=>[f(L,null,{default:_(()=>[f($e)]),_:1})]),_:2},1032,["onClick"])])):q("",!0)])]),empty:_(()=>[m("div",ml,[f(Ce,{type:"info"},{default:_(()=>[te(H(k.$t("chat.noHistory")),1)]),_:1})])]),_:1},8,["style","data","defaultActive"])),[[Ae,i.value]])]),u.value.length?(A(),Q("div",vl,[m("span",null,H(k.$t("chat.only20history")),1)])):q("",!0)]}),_:1})])),[[Ye,r.value],[Ne,Y]])]),_:1}),ce(m("div",gl,null,512),[[Ye,r.value]])])],6)),[[Ae,l.value]])}}});const bl=Mt(kl,[["__scopeId","data-v-e420d0fd"]]),yl=Object.freeze(Object.defineProperty({__proto__:null,default:bl},Symbol.toStringTag,{value:"Module"})),wl={class:"flex align-center"},xl={class:"mr-12 ml-24 flex"},$l=["src"],Cl={class:"chat-embed__main"},Al={class:"ml-4"},Tl={class:"chat-popover w-full"},Rl={class:"border-b p-16-24"},Sl={class:"p-8"},zl={class:"flex-between"},Il={class:"text-center mt-24"},El={key:0,class:"gradient-divider lighter mt-8"},Ll={class:"chat-popover-mask"},Dl=je({__name:"index",props:{application_profile:{},applicationAvailable:{type:Boolean}},setup(g){const{user:t,log:e}=Ve(),n=w(),a=w(!1),o=w(!1),l=w([]),i=w(!1),u=g,r=ne({get:()=>u.application_profile,set:I=>{}}),p=cn({current_page:1,page_size:20,total:0}),v=w([]),c=w("new"),s=w(""),b=ne(()=>{var I,O,k,D;return{background:(O=(I=r.value)==null?void 0:I.custom_theme)==null?void 0:O.theme_color,color:(D=(k=r.value)==null?void 0:k.custom_theme)==null?void 0:D.header_font_color}});function x(I,O){if(I){const k={abstract:I};e.asyncPutChatClientLog(r.value.id,O.id,k,a).then(()=>{const D=l.value.find(F=>F.id===O.id);D&&(D.abstract=I),O.writeStatus=!1})}else un(Fe("views.applicationWorkflow.tip.nameMessage"))}function E(I){I.writeStatus=!0}function R(I){I.writeStatus=!1}function S(I){s.value=I.id}function P(I){e.asyncDelChatClientLog(r.value.id,I.id,o).then(()=>{c.value===I.id&&(c.value="new",p.current_page=1,p.total=0,v.value=[]),Y(r.value.id)})}function Z(I){if(c.value!=="new"&&I.scrollTop===0&&p.total>v.value.length){const O=I.dialogScrollbar.offsetHeight;p.current_page+=1,ee().then(()=>{I.scrollDiv.setScrollTop(I.dialogScrollbar.offsetHeight-O)})}}function X(){i.value=!1}function ie(){p.current_page=1,v.value=[],c.value="new"}function Y(I){const O={current_page:1,page_size:20};e.asyncGetChatLogClient(I,O,o).then(k=>{var D,F;l.value=k.data.records,p.current_page=1,p.total=0,v.value=[],c.value=((F=(D=l.value)==null?void 0:D[0])==null?void 0:F.id)||"new",c.value!=="new"&&ee()})}function ee(){return e.asyncChatRecordLog(r.value.id,c.value,p,a,!1).then(I=>{p.total=I.data.total;const O=I.data.records;O.map(k=>{k.write_ed=!0,k.record_id=k.id}),v.value=[...O,...v.value].sort((k,D)=>k.create_time.localeCompare(D.create_time)),p.current_page===1&&Me(()=>{n.value.setScrollBottom()})})}const le=I=>{I.id!==c.value&&(p.current_page=1,v.value=[],c.value=I.id,c.value!=="new"&&ee(),i.value=!1)};function oe(I){Y(r.value.id),c.value=I}const ue=()=>{(r.value.show_history||!t.isEnterprise())&&Y(r.value.id)};return ft(()=>{ue()}),(I,O)=>{var Ae,Ne,Te,Re,Se,qe,ze,Ie,Ee,Le,ve;const k=y("AppAvatar"),D=y("Plus"),F=y("el-icon"),$=y("el-button"),L=y("AiChat"),V=y("AppIcon"),J=y("ReadWrite"),ae=y("EditPen"),xe=y("Delete"),ke=y("el-text"),$e=y("common-list"),Ce=y("el-scrollbar"),me=y("el-collapse-transition"),Ue=Ge("loading"),Ze=Ge("click-outside");return ce((A(),Q("div",{class:"chat-mobile layout-bg",style:he({"--el-color-primary":(Ne=(Ae=r.value)==null?void 0:Ae.custom_theme)==null?void 0:Ne.theme_color,"--el-color-primary-light-9":U(Xe)((Re=(Te=r.value)==null?void 0:Te.custom_theme)==null?void 0:Re.theme_color,.1)})},[m("div",{class:"chat-embed__header",style:he(b.value)},[m("div",wl,[m("div",xl,[U(lt)((Se=r.value)==null?void 0:Se.icon)?(A(),B(k,{key:0,shape:"square",size:32,style:{background:"none"}},{default:_(()=>{var pe;return[m("img",{src:(pe=r.value)==null?void 0:pe.icon,alt:""},null,8,$l)]}),_:1})):(qe=r.value)!=null&&qe.name?(A(),B(k,{key:1,name:(ze=r.value)==null?void 0:ze.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):q("",!0)]),m("h4",null,H((Ie=r.value)==null?void 0:Ie.name),1)])],4),m("div",null,[m("div",Cl,[f(L,{ref_key:"AiChatRef",ref:n,applicationDetails:r.value,"onUpdate:applicationDetails":O[0]||(O[0]=pe=>r.value=pe),available:I.applicationAvailable,appId:(Ee=r.value)==null?void 0:Ee.id,record:v.value,chatId:c.value,type:"ai-chat",onRefresh:oe,onScroll:Z,class:"AiChat-embed"},{operateBefore:_(()=>[m("div",null,[f($,{type:"primary",link:"",class:"new-chat-button mb-8",onClick:ie},{default:_(()=>[f(F,null,{default:_(()=>[f(D)]),_:1}),m("span",Al,H(I.$t("chat.createChat")),1)]),_:1})])]),_:1},8,["applicationDetails","available","appId","record","chatId"])]),r.value.show_history||!U(t).isEnterprise()?(A(),Q("div",{key:0,onClick:O[1]||(O[1]=de(pe=>i.value=!i.value,["prevent","stop"])),class:"chat-popover-button cursor color-secondary"},[f(V,{iconName:"app-history-outlined",style:he({color:(ve=(Le=r.value)==null?void 0:Le.custom_theme)==null?void 0:ve.header_font_color})},null,8,["style"])])):q("",!0),f(me,null,{default:_(()=>[ce((A(),Q("div",Tl,[m("div",Rl,[m("span",null,H(I.$t("chat.history")),1)]),f(Ce,{"max-height":"300"},{default:_(()=>{var pe,be;return[m("div",Sl,[ce((A(),B($e,{style:he({"--el-color-primary":(be=(pe=r.value)==null?void 0:pe.custom_theme)==null?void 0:be.theme_color}),data:l.value,defaultActive:c.value,onClick:le,onMouseenter:S,onMouseleave:O[3]||(O[3]=W=>s.value="")},{default:_(({row:W})=>[m("div",zl,[f(J,{onChange:ye=>x(ye,W),data:W.abstract,trigger:"manual",write:W.writeStatus,onClose:ye=>R(W),maxlength:1024},null,8,["onChange","data","write","onClose"]),s.value===W.id&&W.id!=="new"&&!W.writeStatus?(A(),Q("div",{key:0,onClick:O[2]||(O[2]=de(()=>{},["stop"])),class:"flex"},[f($,{style:{padding:"0"},link:"",onClick:de(ye=>E(W),["stop"])},{default:_(()=>[f(F,null,{default:_(()=>[f(ae)]),_:1})]),_:2},1032,["onClick"]),f($,{style:{padding:"0"},link:"",onClick:de(ye=>P(W),["stop"])},{default:_(()=>[f(F,null,{default:_(()=>[f(xe)]),_:1})]),_:2},1032,["onClick"])])):q("",!0)])]),empty:_(()=>[m("div",Il,[f(ke,{type:"info"},{default:_(()=>[te(H(I.$t("chat.noHistory")),1)]),_:1})])]),_:1},8,["style","data","defaultActive"])),[[Ue,o.value]])]),l.value.length?(A(),Q("div",El,[m("span",null,H(I.$t("chat.only20history")),1)])):q("",!0)]}),_:1})])),[[Ye,i.value],[Ze,X]])]),_:1}),ce(m("div",Ll,null,512),[[Ye,i.value]])])],4)),[[Ue,a.value]])}}});const Pl=Mt(Dl,[["__scopeId","data-v-7924202d"]]),Ml=Object.freeze(Object.defineProperty({__proto__:null,default:Pl},Symbol.toStringTag,{value:"Module"})),Bl={class:"dialog-footer"},hn=je({__name:"EditTitleDialog",emits:["refresh"],setup(g,{expose:t,emit:e}){const{log:n}=Ve(),a=e,o=w(),l=w(!1),i=w(""),u=w(""),r=w({abstract:""}),p=w(!1),v=(s,b)=>{i.value=b,u.value=s.id,r.value.abstract=s.abstract,p.value=!0},c=async s=>{s&&await s.validate(b=>{b&&n.asyncPutChatClientLog(i.value,u.value,r.value,l).then(()=>{a("refresh",u.value,r.value.abstract),p.value=!1})})};return t({open:v,close}),(s,b)=>{const x=y("el-input"),E=y("el-form-item"),R=y("el-form"),S=y("el-button"),P=y("el-dialog");return A(),B(P,{class:"responsive-dialog",title:s.$t("chat.editTitle"),modelValue:p.value,"onUpdate:modelValue":b[4]||(b[4]=Z=>p.value=Z),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0,"append-to-body":""},{footer:_(()=>[m("span",Bl,[f(S,{onClick:b[2]||(b[2]=de(Z=>p.value=!1,["prevent"]))},{default:_(()=>[te(H(s.$t("common.cancel")),1)]),_:1}),f(S,{type:"primary",onClick:b[3]||(b[3]=Z=>c(o.value)),loading:l.value},{default:_(()=>[te(H(s.$t("common.save")),1)]),_:1},8,["loading"])])]),default:_(()=>[f(R,{"label-position":"top",ref_key:"fieldFormRef",ref:o,model:r.value,"require-asterisk-position":"right"},{default:_(()=>[f(E,{prop:"abstract",rules:[{required:!0,message:s.$t("common.inputPlaceholder"),trigger:"blur"}]},{default:_(()=>[f(x,{modelValue:r.value.abstract,"onUpdate:modelValue":b[0]||(b[0]=Z=>r.value.abstract=Z),maxlength:"1024","show-word-limit":"",type:"textarea",onBlur:b[1]||(b[1]=Z=>r.value.abstract=r.value.abstract.trim())},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])}}});function Bt(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let Ke=Bt();function fn(g){Ke=g}const _n=/[&<>"']/,Hl=new RegExp(_n.source,"g"),mn=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,ql=new RegExp(mn.source,"g"),Ol={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ln=g=>Ol[g];function ge(g,t){if(t){if(_n.test(g))return g.replace(Hl,ln)}else if(mn.test(g))return g.replace(ql,ln);return g}const Fl=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function jl(g){return g.replace(Fl,(t,e)=>(e=e.toLowerCase(),e==="colon"?":":e.charAt(0)==="#"?e.charAt(1)==="x"?String.fromCharCode(parseInt(e.substring(2),16)):String.fromCharCode(+e.substring(1)):""))}const Vl=/(^|[^\[])\^/g;function N(g,t){let e=typeof g=="string"?g:g.source;t=t||"";const n={replace:(a,o)=>{let l=typeof o=="string"?o:o.source;return l=l.replace(Vl,"$1"),e=e.replace(a,l),n},getRegex:()=>new RegExp(e,t)};return n}function on(g){try{g=encodeURI(g).replace(/%25/g,"%")}catch{return null}return g}const ut={exec:()=>null};function an(g,t){const e=g.replace(/\|/g,(o,l,i)=>{let u=!1,r=l;for(;--r>=0&&i[r]==="\\";)u=!u;return u?"|":" |"}),n=e.split(/ \|/);let a=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;a<n.length;a++)n[a]=n[a].trim().replace(/\\\|/g,"|");return n}function bt(g,t,e){const n=g.length;if(n===0)return"";let a=0;for(;a<n;){const o=g.charAt(n-a-1);if(o===t&&!e)a++;else if(o!==t&&e)a++;else break}return g.slice(0,n-a)}function Ul(g,t){if(g.indexOf(t[1])===-1)return-1;let e=0;for(let n=0;n<g.length;n++)if(g[n]==="\\")n++;else if(g[n]===t[0])e++;else if(g[n]===t[1]&&(e--,e<0))return n;return-1}function sn(g,t,e,n){const a=t.href,o=t.title?ge(t.title):null,l=g[1].replace(/\\([\[\]])/g,"$1");if(g[0].charAt(0)!=="!"){n.state.inLink=!0;const i={type:"link",raw:e,href:a,title:o,text:l,tokens:n.inlineTokens(l)};return n.state.inLink=!1,i}return{type:"image",raw:e,href:a,title:o,text:ge(l)}}function Zl(g,t){const e=g.match(/^(\s+)(?:```)/);if(e===null)return t;const n=e[1];return t.split(`
`).map(a=>{const o=a.match(/^\s+/);if(o===null)return a;const[l]=o;return l.length>=n.length?a.slice(n.length):a}).join(`
`)}class wt{constructor(t){G(this,"options");G(this,"rules");G(this,"lexer");this.options=t||Ke}space(t){const e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){const e=this.rules.block.code.exec(t);if(e){const n=e[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:bt(n,`
`)}}}fences(t){const e=this.rules.block.fences.exec(t);if(e){const n=e[0],a=Zl(n,e[3]||"");return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:a}}}heading(t){const e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(/#$/.test(n)){const a=bt(n,"#");(this.options.pedantic||!a||/ $/.test(a))&&(n=a.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){const e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:e[0]}}blockquote(t){const e=this.rules.block.blockquote.exec(t);if(e){let n=e[0].replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`);n=bt(n.replace(/^ *>[ \t]?/gm,""),`
`);const a=this.lexer.state.top;this.lexer.state.top=!0;const o=this.lexer.blockTokens(n);return this.lexer.state.top=a,{type:"blockquote",raw:e[0],tokens:o,text:n}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim();const a=n.length>1,o={type:"list",raw:"",ordered:a,start:a?+n.slice(0,-1):"",loose:!1,items:[]};n=a?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=a?n:"[*+-]");const l=new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`);let i="",u="",r=!1;for(;t;){let p=!1;if(!(e=l.exec(t))||this.rules.block.hr.test(t))break;i=e[0],t=t.substring(i.length);let v=e[2].split(`
`,1)[0].replace(/^\t+/,R=>" ".repeat(3*R.length)),c=t.split(`
`,1)[0],s=0;this.options.pedantic?(s=2,u=v.trimStart()):(s=e[2].search(/[^ ]/),s=s>4?1:s,u=v.slice(s),s+=e[1].length);let b=!1;if(!v&&/^ *$/.test(c)&&(i+=c+`
`,t=t.substring(c.length+1),p=!0),!p){const R=new RegExp(`^ {0,${Math.min(3,s-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),S=new RegExp(`^ {0,${Math.min(3,s-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),P=new RegExp(`^ {0,${Math.min(3,s-1)}}(?:\`\`\`|~~~)`),Z=new RegExp(`^ {0,${Math.min(3,s-1)}}#`);for(;t;){const X=t.split(`
`,1)[0];if(c=X,this.options.pedantic&&(c=c.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),P.test(c)||Z.test(c)||R.test(c)||S.test(t))break;if(c.search(/[^ ]/)>=s||!c.trim())u+=`
`+c.slice(s);else{if(b||v.search(/[^ ]/)>=4||P.test(v)||Z.test(v)||S.test(v))break;u+=`
`+c}!b&&!c.trim()&&(b=!0),i+=X+`
`,t=t.substring(X.length+1),v=c.slice(s)}}o.loose||(r?o.loose=!0:/\n *\n *$/.test(i)&&(r=!0));let x=null,E;this.options.gfm&&(x=/^\[[ xX]\] /.exec(u),x&&(E=x[0]!=="[ ] ",u=u.replace(/^\[[ xX]\] +/,""))),o.items.push({type:"list_item",raw:i,task:!!x,checked:E,loose:!1,text:u,tokens:[]}),o.raw+=i}o.items[o.items.length-1].raw=i.trimEnd(),o.items[o.items.length-1].text=u.trimEnd(),o.raw=o.raw.trimEnd();for(let p=0;p<o.items.length;p++)if(this.lexer.state.top=!1,o.items[p].tokens=this.lexer.blockTokens(o.items[p].text,[]),!o.loose){const v=o.items[p].tokens.filter(s=>s.type==="space"),c=v.length>0&&v.some(s=>/\n.*\n/.test(s.raw));o.loose=c}if(o.loose)for(let p=0;p<o.items.length;p++)o.items[p].loose=!0;return o}}html(t){const e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){const e=this.rules.block.def.exec(t);if(e){const n=e[1].toLowerCase().replace(/\s+/g," "),a=e[2]?e[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",o=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:a,title:o}}}table(t){const e=this.rules.block.table.exec(t);if(!e||!/[:|]/.test(e[2]))return;const n=an(e[1]),a=e[2].replace(/^\||\| *$/g,"").split("|"),o=e[3]&&e[3].trim()?e[3].replace(/\n[ \t]*$/,"").split(`
`):[],l={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===a.length){for(const i of a)/^ *-+: *$/.test(i)?l.align.push("right"):/^ *:-+: *$/.test(i)?l.align.push("center"):/^ *:-+ *$/.test(i)?l.align.push("left"):l.align.push(null);for(const i of n)l.header.push({text:i,tokens:this.lexer.inline(i)});for(const i of o)l.rows.push(an(i,l.header.length).map(u=>({text:u,tokens:this.lexer.inline(u)})));return l}}lheading(t){const e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){const e=this.rules.block.paragraph.exec(t);if(e){const n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){const e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){const e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:ge(e[1])}}tag(t){const e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&/^<a /i.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){const e=this.rules.inline.link.exec(t);if(e){const n=e[2].trim();if(!this.options.pedantic&&/^</.test(n)){if(!/>$/.test(n))return;const l=bt(n.slice(0,-1),"\\");if((n.length-l.length)%2===0)return}else{const l=Ul(e[2],"()");if(l>-1){const u=(e[0].indexOf("!")===0?5:4)+e[1].length+l;e[2]=e[2].substring(0,l),e[0]=e[0].substring(0,u).trim(),e[3]=""}}let a=e[2],o="";if(this.options.pedantic){const l=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(a);l&&(a=l[1],o=l[3])}else o=e[3]?e[3].slice(1,-1):"";return a=a.trim(),/^</.test(a)&&(this.options.pedantic&&!/>$/.test(n)?a=a.slice(1):a=a.slice(1,-1)),sn(e,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:o&&o.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){const a=(n[2]||n[1]).replace(/\s+/g," "),o=e[a.toLowerCase()];if(!o){const l=n[0].charAt(0);return{type:"text",raw:l,text:l}}return sn(n,o,n[0],this.lexer)}}emStrong(t,e,n=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!a||a[3]&&n.match(/[\p{L}\p{N}]/u))return;if(!(a[1]||a[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const l=[...a[0]].length-1;let i,u,r=l,p=0;const v=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(v.lastIndex=0,e=e.slice(-1*t.length+l);(a=v.exec(e))!=null;){if(i=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!i)continue;if(u=[...i].length,a[3]||a[4]){r+=u;continue}else if((a[5]||a[6])&&l%3&&!((l+u)%3)){p+=u;continue}if(r-=u,r>0)continue;u=Math.min(u,u+r+p);const c=[...a[0]][0].length,s=t.slice(0,l+a.index+c+u);if(Math.min(l,u)%2){const x=s.slice(1,-1);return{type:"em",raw:s,text:x,tokens:this.lexer.inlineTokens(x)}}const b=s.slice(2,-2);return{type:"strong",raw:s,text:b,tokens:this.lexer.inlineTokens(b)}}}}codespan(t){const e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(/\n/g," ");const a=/[^ ]/.test(n),o=/^ /.test(n)&&/ $/.test(n);return a&&o&&(n=n.substring(1,n.length-1)),n=ge(n,!0),{type:"codespan",raw:e[0],text:n}}}br(t){const e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){const e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){const e=this.rules.inline.autolink.exec(t);if(e){let n,a;return e[2]==="@"?(n=ge(e[1]),a="mailto:"+n):(n=ge(e[1]),a=n),{type:"link",raw:e[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let a,o;if(e[2]==="@")a=ge(e[0]),o="mailto:"+a;else{let l;do l=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(l!==e[0]);a=ge(e[0]),e[1]==="www."?o="http://"+e[0]:o=e[0]}return{type:"link",raw:e[0],text:a,href:o,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){const e=this.rules.inline.text.exec(t);if(e){let n;return this.lexer.state.inRawBlock?n=e[0]:n=ge(e[0]),{type:"text",raw:e[0],text:n}}}}const Nl=/^(?: *(?:\n|$))+/,Ql=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,Wl=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,_t=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Gl=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,vn=/(?:[*+-]|\d{1,9}[.)])/,gn=N(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,vn).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),Ht=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Yl=/^[^\n]+/,qt=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Xl=N(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",qt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Jl=N(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,vn).getRegex(),Tt="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ot=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Kl=N("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",Ot).replace("tag",Tt).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),kn=N(Ht).replace("hr",_t).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Tt).getRegex(),eo=N(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",kn).getRegex(),Ft={blockquote:eo,code:Ql,def:Xl,fences:Wl,heading:Gl,hr:_t,html:Kl,lheading:gn,list:Jl,newline:Nl,paragraph:kn,table:ut,text:Yl},rn=N("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",_t).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Tt).getRegex(),to={...Ft,table:rn,paragraph:N(Ht).replace("hr",_t).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",rn).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Tt).getRegex()},no={...Ft,html:N(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ot).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ut,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:N(Ht).replace("hr",_t).replace("heading",` *#{1,6} *[^
]`).replace("lheading",gn).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},bn=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,lo=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,yn=/^( {2,}|\\)\n(?!\s*$)/,oo=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,mt="\\p{P}\\p{S}",ao=N(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,mt).getRegex(),so=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,io=N(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,mt).getRegex(),ro=N("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,mt).getRegex(),co=N("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,mt).getRegex(),uo=N(/\\([punct])/,"gu").replace(/punct/g,mt).getRegex(),po=N(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),ho=N(Ot).replace("(?:-->|$)","-->").getRegex(),fo=N("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",ho).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),xt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,_o=N(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",xt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),wn=N(/^!?\[(label)\]\[(ref)\]/).replace("label",xt).replace("ref",qt).getRegex(),xn=N(/^!?\[(ref)\](?:\[\])?/).replace("ref",qt).getRegex(),mo=N("reflink|nolink(?!\\()","g").replace("reflink",wn).replace("nolink",xn).getRegex(),jt={_backpedal:ut,anyPunctuation:uo,autolink:po,blockSkip:so,br:yn,code:lo,del:ut,emStrongLDelim:io,emStrongRDelimAst:ro,emStrongRDelimUnd:co,escape:bn,link:_o,nolink:xn,punctuation:ao,reflink:wn,reflinkSearch:mo,tag:fo,text:oo,url:ut},vo={...jt,link:N(/^!?\[(label)\]\((.*?)\)/).replace("label",xt).getRegex(),reflink:N(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",xt).getRegex()},Et={...jt,escape:N(bn).replace("])","~|])").getRegex(),url:N(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},go={...Et,br:N(yn).replace("{2,}","*").getRegex(),text:N(Et.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},yt={normal:Ft,gfm:to,pedantic:no},ct={normal:jt,gfm:Et,breaks:go,pedantic:vo};class Be{constructor(t){G(this,"tokens");G(this,"options");G(this,"state");G(this,"tokenizer");G(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Ke,this.options.tokenizer=this.options.tokenizer||new wt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const e={block:yt.normal,inline:ct.normal};this.options.pedantic?(e.block=yt.pedantic,e.inline=ct.pedantic):this.options.gfm&&(e.block=yt.gfm,this.options.breaks?e.inline=ct.breaks:e.inline=ct.gfm),this.tokenizer.rules=e}static get rules(){return{block:yt,inline:ct}}static lex(t,e){return new Be(e).lex(t)}static lexInline(t,e){return new Be(e).inlineTokens(t)}lex(t){t=t.replace(/\r\n|\r/g,`
`),this.blockTokens(t,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){const n=this.inlineQueue[e];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,e=[]){this.options.pedantic?t=t.replace(/\t/g,"    ").replace(/^ +$/gm,""):t=t.replace(/^( *)(\t+)/gm,(i,u,r)=>u+"    ".repeat(r.length));let n,a,o,l;for(;t;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(i=>(n=i.call({lexer:this},t,e))?(t=t.substring(n.raw.length),e.push(n),!0):!1))){if(n=this.tokenizer.space(t)){t=t.substring(n.raw.length),n.raw.length===1&&e.length>0?e[e.length-1].raw+=`
`:e.push(n);continue}if(n=this.tokenizer.code(t)){t=t.substring(n.raw.length),a=e[e.length-1],a&&(a.type==="paragraph"||a.type==="text")?(a.raw+=`
`+n.raw,a.text+=`
`+n.text,this.inlineQueue[this.inlineQueue.length-1].src=a.text):e.push(n);continue}if(n=this.tokenizer.fences(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.heading(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.hr(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.blockquote(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.list(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.html(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.def(t)){t=t.substring(n.raw.length),a=e[e.length-1],a&&(a.type==="paragraph"||a.type==="text")?(a.raw+=`
`+n.raw,a.text+=`
`+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=a.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.lheading(t)){t=t.substring(n.raw.length),e.push(n);continue}if(o=t,this.options.extensions&&this.options.extensions.startBlock){let i=1/0;const u=t.slice(1);let r;this.options.extensions.startBlock.forEach(p=>{r=p.call({lexer:this},u),typeof r=="number"&&r>=0&&(i=Math.min(i,r))}),i<1/0&&i>=0&&(o=t.substring(0,i+1))}if(this.state.top&&(n=this.tokenizer.paragraph(o))){a=e[e.length-1],l&&a.type==="paragraph"?(a.raw+=`
`+n.raw,a.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):e.push(n),l=o.length!==t.length,t=t.substring(n.raw.length);continue}if(n=this.tokenizer.text(t)){t=t.substring(n.raw.length),a=e[e.length-1],a&&a.type==="text"?(a.raw+=`
`+n.raw,a.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):e.push(n);continue}if(t){const i="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(i);break}else throw new Error(i)}}return this.state.top=!0,e}inline(t,e=[]){return this.inlineQueue.push({src:t,tokens:e}),e}inlineTokens(t,e=[]){let n,a,o,l=t,i,u,r;if(this.tokens.links){const p=Object.keys(this.tokens.links);if(p.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(l))!=null;)p.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(l=l.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.blockSkip.exec(l))!=null;)l=l.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(l))!=null;)l=l.slice(0,i.index)+"++"+l.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;t;)if(u||(r=""),u=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(p=>(n=p.call({lexer:this},t,e))?(t=t.substring(n.raw.length),e.push(n),!0):!1))){if(n=this.tokenizer.escape(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.tag(t)){t=t.substring(n.raw.length),a=e[e.length-1],a&&n.type==="text"&&a.type==="text"?(a.raw+=n.raw,a.text+=n.text):e.push(n);continue}if(n=this.tokenizer.link(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(n.raw.length),a=e[e.length-1],a&&n.type==="text"&&a.type==="text"?(a.raw+=n.raw,a.text+=n.text):e.push(n);continue}if(n=this.tokenizer.emStrong(t,l,r)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.codespan(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.br(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.del(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.autolink(t)){t=t.substring(n.raw.length),e.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(t))){t=t.substring(n.raw.length),e.push(n);continue}if(o=t,this.options.extensions&&this.options.extensions.startInline){let p=1/0;const v=t.slice(1);let c;this.options.extensions.startInline.forEach(s=>{c=s.call({lexer:this},v),typeof c=="number"&&c>=0&&(p=Math.min(p,c))}),p<1/0&&p>=0&&(o=t.substring(0,p+1))}if(n=this.tokenizer.inlineText(o)){t=t.substring(n.raw.length),n.raw.slice(-1)!=="_"&&(r=n.raw.slice(-1)),u=!0,a=e[e.length-1],a&&a.type==="text"?(a.raw+=n.raw,a.text+=n.text):e.push(n);continue}if(t){const p="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(p);break}else throw new Error(p)}}return e}}class $t{constructor(t){G(this,"options");this.options=t||Ke}code(t,e,n){var o;const a=(o=(e||"").match(/^\S*/))==null?void 0:o[0];return t=t.replace(/\n$/,"")+`
`,a?'<pre><code class="language-'+ge(a)+'">'+(n?t:ge(t,!0))+`</code></pre>
`:"<pre><code>"+(n?t:ge(t,!0))+`</code></pre>
`}blockquote(t){return`<blockquote>
${t}</blockquote>
`}html(t,e){return t}heading(t,e,n){return`<h${e}>${t}</h${e}>
`}hr(){return`<hr>
`}list(t,e,n){const a=e?"ol":"ul",o=e&&n!==1?' start="'+n+'"':"";return"<"+a+o+`>
`+t+"</"+a+`>
`}listitem(t,e,n){return`<li>${t}</li>
`}checkbox(t){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(t){return`<p>${t}</p>
`}table(t,e){return e&&(e=`<tbody>${e}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+e+`</table>
`}tablerow(t){return`<tr>
${t}</tr>
`}tablecell(t,e){const n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong(t){return`<strong>${t}</strong>`}em(t){return`<em>${t}</em>`}codespan(t){return`<code>${t}</code>`}br(){return"<br>"}del(t){return`<del>${t}</del>`}link(t,e,n){const a=on(t);if(a===null)return n;t=a;let o='<a href="'+t+'"';return e&&(o+=' title="'+e+'"'),o+=">"+n+"</a>",o}image(t,e,n){const a=on(t);if(a===null)return n;t=a;let o=`<img src="${t}" alt="${n}"`;return e&&(o+=` title="${e}"`),o+=">",o}text(t){return t}}class Vt{strong(t){return t}em(t){return t}codespan(t){return t}del(t){return t}html(t){return t}text(t){return t}link(t,e,n){return""+n}image(t,e,n){return""+n}br(){return""}}class He{constructor(t){G(this,"options");G(this,"renderer");G(this,"textRenderer");this.options=t||Ke,this.options.renderer=this.options.renderer||new $t,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Vt}static parse(t,e){return new He(e).parse(t)}static parseInline(t,e){return new He(e).parseInline(t)}parse(t,e=!0){let n="";for(let a=0;a<t.length;a++){const o=t[a];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){const l=o,i=this.options.extensions.renderers[l.type].call({parser:this},l);if(i!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(l.type)){n+=i||"";continue}}switch(o.type){case"space":continue;case"hr":{n+=this.renderer.hr();continue}case"heading":{const l=o;n+=this.renderer.heading(this.parseInline(l.tokens),l.depth,jl(this.parseInline(l.tokens,this.textRenderer)));continue}case"code":{const l=o;n+=this.renderer.code(l.text,l.lang,!!l.escaped);continue}case"table":{const l=o;let i="",u="";for(let p=0;p<l.header.length;p++)u+=this.renderer.tablecell(this.parseInline(l.header[p].tokens),{header:!0,align:l.align[p]});i+=this.renderer.tablerow(u);let r="";for(let p=0;p<l.rows.length;p++){const v=l.rows[p];u="";for(let c=0;c<v.length;c++)u+=this.renderer.tablecell(this.parseInline(v[c].tokens),{header:!1,align:l.align[c]});r+=this.renderer.tablerow(u)}n+=this.renderer.table(i,r);continue}case"blockquote":{const l=o,i=this.parse(l.tokens);n+=this.renderer.blockquote(i);continue}case"list":{const l=o,i=l.ordered,u=l.start,r=l.loose;let p="";for(let v=0;v<l.items.length;v++){const c=l.items[v],s=c.checked,b=c.task;let x="";if(c.task){const E=this.renderer.checkbox(!!s);r?c.tokens.length>0&&c.tokens[0].type==="paragraph"?(c.tokens[0].text=E+" "+c.tokens[0].text,c.tokens[0].tokens&&c.tokens[0].tokens.length>0&&c.tokens[0].tokens[0].type==="text"&&(c.tokens[0].tokens[0].text=E+" "+c.tokens[0].tokens[0].text)):c.tokens.unshift({type:"text",text:E+" "}):x+=E+" "}x+=this.parse(c.tokens,r),p+=this.renderer.listitem(x,b,!!s)}n+=this.renderer.list(p,i,u);continue}case"html":{const l=o;n+=this.renderer.html(l.text,l.block);continue}case"paragraph":{const l=o;n+=this.renderer.paragraph(this.parseInline(l.tokens));continue}case"text":{let l=o,i=l.tokens?this.parseInline(l.tokens):l.text;for(;a+1<t.length&&t[a+1].type==="text";)l=t[++a],i+=`
`+(l.tokens?this.parseInline(l.tokens):l.text);n+=e?this.renderer.paragraph(i):i;continue}default:{const l='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return n}parseInline(t,e){e=e||this.renderer;let n="";for(let a=0;a<t.length;a++){const o=t[a];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){const l=this.options.extensions.renderers[o.type].call({parser:this},o);if(l!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=l||"";continue}}switch(o.type){case"escape":{const l=o;n+=e.text(l.text);break}case"html":{const l=o;n+=e.html(l.text);break}case"link":{const l=o;n+=e.link(l.href,l.title,this.parseInline(l.tokens,e));break}case"image":{const l=o;n+=e.image(l.href,l.title,l.text);break}case"strong":{const l=o;n+=e.strong(this.parseInline(l.tokens,e));break}case"em":{const l=o;n+=e.em(this.parseInline(l.tokens,e));break}case"codespan":{const l=o;n+=e.codespan(l.text);break}case"br":{n+=e.br();break}case"del":{const l=o;n+=e.del(this.parseInline(l.tokens,e));break}case"text":{const l=o;n+=e.text(l.text);break}default:{const l='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return n}}class pt{constructor(t){G(this,"options");this.options=t||Ke}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}}G(pt,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));var ht,Lt,At,$n;class ko{constructor(...t){St(this,ht);St(this,At);G(this,"defaults",Bt());G(this,"options",this.setOptions);G(this,"parse",kt(this,ht,Lt).call(this,Be.lex,He.parse));G(this,"parseInline",kt(this,ht,Lt).call(this,Be.lexInline,He.parseInline));G(this,"Parser",He);G(this,"Renderer",$t);G(this,"TextRenderer",Vt);G(this,"Lexer",Be);G(this,"Tokenizer",wt);G(this,"Hooks",pt);this.use(...t)}walkTokens(t,e){var a,o;let n=[];for(const l of t)switch(n=n.concat(e.call(this,l)),l.type){case"table":{const i=l;for(const u of i.header)n=n.concat(this.walkTokens(u.tokens,e));for(const u of i.rows)for(const r of u)n=n.concat(this.walkTokens(r.tokens,e));break}case"list":{const i=l;n=n.concat(this.walkTokens(i.items,e));break}default:{const i=l;(o=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&o[i.type]?this.defaults.extensions.childTokens[i.type].forEach(u=>{const r=i[u].flat(1/0);n=n.concat(this.walkTokens(r,e))}):i.tokens&&(n=n.concat(this.walkTokens(i.tokens,e)))}}return n}use(...t){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{const a={...n};if(a.async=this.defaults.async||a.async||!1,n.extensions&&(n.extensions.forEach(o=>{if(!o.name)throw new Error("extension name required");if("renderer"in o){const l=e.renderers[o.name];l?e.renderers[o.name]=function(...i){let u=o.renderer.apply(this,i);return u===!1&&(u=l.apply(this,i)),u}:e.renderers[o.name]=o.renderer}if("tokenizer"in o){if(!o.level||o.level!=="block"&&o.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const l=e[o.level];l?l.unshift(o.tokenizer):e[o.level]=[o.tokenizer],o.start&&(o.level==="block"?e.startBlock?e.startBlock.push(o.start):e.startBlock=[o.start]:o.level==="inline"&&(e.startInline?e.startInline.push(o.start):e.startInline=[o.start]))}"childTokens"in o&&o.childTokens&&(e.childTokens[o.name]=o.childTokens)}),a.extensions=e),n.renderer){const o=this.defaults.renderer||new $t(this.defaults);for(const l in n.renderer){if(!(l in o))throw new Error(`renderer '${l}' does not exist`);if(l==="options")continue;const i=l,u=n.renderer[i],r=o[i];o[i]=(...p)=>{let v=u.apply(o,p);return v===!1&&(v=r.apply(o,p)),v||""}}a.renderer=o}if(n.tokenizer){const o=this.defaults.tokenizer||new wt(this.defaults);for(const l in n.tokenizer){if(!(l in o))throw new Error(`tokenizer '${l}' does not exist`);if(["options","rules","lexer"].includes(l))continue;const i=l,u=n.tokenizer[i],r=o[i];o[i]=(...p)=>{let v=u.apply(o,p);return v===!1&&(v=r.apply(o,p)),v}}a.tokenizer=o}if(n.hooks){const o=this.defaults.hooks||new pt;for(const l in n.hooks){if(!(l in o))throw new Error(`hook '${l}' does not exist`);if(l==="options")continue;const i=l,u=n.hooks[i],r=o[i];pt.passThroughHooks.has(l)?o[i]=p=>{if(this.defaults.async)return Promise.resolve(u.call(o,p)).then(c=>r.call(o,c));const v=u.call(o,p);return r.call(o,v)}:o[i]=(...p)=>{let v=u.apply(o,p);return v===!1&&(v=r.apply(o,p)),v}}a.hooks=o}if(n.walkTokens){const o=this.defaults.walkTokens,l=n.walkTokens;a.walkTokens=function(i){let u=[];return u.push(l.call(this,i)),o&&(u=u.concat(o.call(this,i))),u}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Be.lex(t,e??this.defaults)}parser(t,e){return He.parse(t,e??this.defaults)}}ht=new WeakSet,Lt=function(t,e){return(n,a)=>{const o={...a},l={...this.defaults,...o};this.defaults.async===!0&&o.async===!1&&(l.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),l.async=!0);const i=kt(this,At,$n).call(this,!!l.silent,!!l.async);if(typeof n>"u"||n===null)return i(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));if(l.hooks&&(l.hooks.options=l),l.async)return Promise.resolve(l.hooks?l.hooks.preprocess(n):n).then(u=>t(u,l)).then(u=>l.hooks?l.hooks.processAllTokens(u):u).then(u=>l.walkTokens?Promise.all(this.walkTokens(u,l.walkTokens)).then(()=>u):u).then(u=>e(u,l)).then(u=>l.hooks?l.hooks.postprocess(u):u).catch(i);try{l.hooks&&(n=l.hooks.preprocess(n));let u=t(n,l);l.hooks&&(u=l.hooks.processAllTokens(u)),l.walkTokens&&this.walkTokens(u,l.walkTokens);let r=e(u,l);return l.hooks&&(r=l.hooks.postprocess(r)),r}catch(u){return i(u)}}},At=new WeakSet,$n=function(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){const a="<p>An error occurred:</p><pre>"+ge(n.message+"",!0)+"</pre>";return e?Promise.resolve(a):a}if(e)return Promise.reject(n);throw n}};const Je=new ko;function j(g,t){return Je.parse(g,t)}j.options=j.setOptions=function(g){return Je.setOptions(g),j.defaults=Je.defaults,fn(j.defaults),j};j.getDefaults=Bt;j.defaults=Ke;j.use=function(...g){return Je.use(...g),j.defaults=Je.defaults,fn(j.defaults),j};j.walkTokens=function(g,t){return Je.walkTokens(g,t)};j.parseInline=Je.parseInline;j.Parser=He;j.parser=He.parse;j.Renderer=$t;j.TextRenderer=Vt;j.Lexer=Be;j.lexer=Be.lex;j.Tokenizer=wt;j.Hooks=pt;j.parse=j;j.options;j.setOptions;j.use;j.walkTokens;j.parseInline;He.parse;Be.lex;var Cn={exports:{}};(function(g,t){(function(e,n){n()})(rt,function(){function e(r,p){return typeof p>"u"?p={autoBom:!1}:typeof p!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),p={autoBom:!p}),p.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob(["\uFEFF",r],{type:r.type}):r}function n(r,p,v){var c=new XMLHttpRequest;c.open("GET",r),c.responseType="blob",c.onload=function(){u(c.response,p,v)},c.onerror=function(){console.error("could not download file")},c.send()}function a(r){var p=new XMLHttpRequest;p.open("HEAD",r,!1);try{p.send()}catch{}return 200<=p.status&&299>=p.status}function o(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var p=document.createEvent("MouseEvents");p.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(p)}}var l=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof rt=="object"&&rt.global===rt?rt:void 0,i=l.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=l.saveAs||(typeof window!="object"||window!==l?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(r,p,v){var c=l.URL||l.webkitURL,s=document.createElement("a");p=p||r.name||"download",s.download=p,s.rel="noopener",typeof r=="string"?(s.href=r,s.origin===location.origin?o(s):a(s.href)?n(r,p,v):o(s,s.target="_blank")):(s.href=c.createObjectURL(r),setTimeout(function(){c.revokeObjectURL(s.href)},4e4),setTimeout(function(){o(s)},0))}:"msSaveOrOpenBlob"in navigator?function(r,p,v){if(p=p||r.name||"download",typeof r!="string")navigator.msSaveOrOpenBlob(e(r,v),p);else if(a(r))n(r,p,v);else{var c=document.createElement("a");c.href=r,c.target="_blank",setTimeout(function(){o(c)})}}:function(r,p,v,c){if(c=c||open("","_blank"),c&&(c.document.title=c.document.body.innerText="downloading..."),typeof r=="string")return n(r,p,v);var s=r.type==="application/octet-stream",b=/constructor/i.test(l.HTMLElement)||l.safari,x=/CriOS\/[\d]+/.test(navigator.userAgent);if((x||s&&b||i)&&typeof FileReader<"u"){var E=new FileReader;E.onloadend=function(){var P=E.result;P=x?P:P.replace(/^data:[^;]*;/,"data:attachment/file;"),c?c.location.href=P:location=P,c=null},E.readAsDataURL(r)}else{var R=l.URL||l.webkitURL,S=R.createObjectURL(r);c?c.location=S:location.href=S,c=null,setTimeout(function(){R.revokeObjectURL(S)},4e4)}});l.saveAs=u.saveAs=u,g.exports=u})})(Cn);var Ct=Cn.exports;const bo={class:"flex align-center"},yo={class:"mr-12 ml-24 flex"},wo=["src"],xo={class:"chat-pc-form__main"},$o={class:"flex"},Co={key:0,class:"chat-pc-form__left border-r"},Ao={class:"p-24 pb-0"},To={class:"left-height pt-0"},Ro={class:"p-8 pt-0"},So={class:"flex-between"},zo={class:"text-center"},Io={class:"chat-pc-form__right"},Eo={class:"right-header border-b mb-24 p-16-24 flex-between"},Lo={class:"ellipsis-1",style:{width:"66%"}},Do={key:0,class:"flex align-center"},Po={class:"right-height"},Mo={class:"form-response-layout"},Bo={class:"form-section"},Ho={class:"p-16"},qo={class:"flex align-center"},Oo={key:0},Fo={class:"form-actions mt-24"},jo={class:"flex gap-12"},Vo={key:1,class:"empty-form"},Uo={class:"response-section"},Zo={key:0,class:"ai-chat-result mt-24"},No={class:"item-content mb-16 lighter"},Qo={key:0,class:"avatar mr-8"},Wo=["src"],Go={class:"content",style:{"padding-right":"0"}},Yo={class:"content",style:{"padding-left":"44px","padding-right":"0"}},Xo={class:"operation-button-container"},Jo={key:0,class:"mt-8"},Ko={class:"chat-operation-button flex-between mt-8"},ea={class:"ml-4"},ta={class:"flex align-center"},na=je({__name:"index",props:{application_profile:{},applicationAvailable:{type:Boolean}},setup(g){const{user:t,log:e,common:n}=Ve(),a=g,o=w(),l=w(),i=w(),u=w(),r=w(!1),p=w(!1),v=w(!1),c=w({}),s=w(null),b=w("new"),x=w("新建表单"),E=w(""),R=w([]),S=w("-1"),P=w(!1),Z=w(0),X=w(""),ie=w(""),Y=w({current_page:1,page_size:20,total:0}),ee=w([]),le=w(!1),oe=w(!1),ue=w(null),I=w(0),O=w(!0),k=ne({get:()=>a.application_profile,set:d=>{}}),D=ne(()=>{var d,h,C,T;return{background:(h=(d=k.value)==null?void 0:d.custom_theme)==null?void 0:h.theme_color,color:(T=(C=k.value)==null?void 0:C.custom_theme)==null?void 0:T.header_font_color}}),F=ne(()=>{var d;return(((d=k.value)==null?void 0:d.show_history)||!t.isEnterprise())&&a.applicationAvailable}),$=ne(()=>{var d;return t.isEnterprise()?(d=k.value)==null?void 0:d.show_avatar:!0}),L=ne(()=>{var T,M,re,K,fe,Oe,we,Qe;const d=(re=(M=(T=k.value)==null?void 0:T.work_flow)==null?void 0:M.nodes)==null?void 0:re.find(z=>z.id==="base-node"),h=((K=d==null?void 0:d.properties)==null?void 0:K.user_input_field_list)||((fe=d==null?void 0:d.properties)==null?void 0:fe.input_field_list)||[];if(console.log("原始表单字段数据:",{baseNode:d,user_input_field_list:(Oe=d==null?void 0:d.properties)==null?void 0:Oe.user_input_field_list,input_field_list:(we=d==null?void 0:d.properties)==null?void 0:we.input_field_list,inputFields:h}),(Qe=d==null?void 0:d.properties)!=null&&Qe.user_input_field_list)return console.log("使用user_input_field_list，直接返回:",h),h;const C=h.filter(z=>z.assignment_method==="user_input").map(z=>{if(console.log("映射单个字段:",z),!z||typeof z!="object")return console.warn("无效的字段对象:",z),null;switch(z.type){case"input":return{field:z.variable,input_type:"TextInput",label:z.name,default_value:z.default_value,required:z.is_required};case"select":return{field:z.variable,input_type:"SingleSelect",label:z.name,default_value:z.default_value,required:z.is_required,option_list:(z.optionList||[]).map(ot=>({key:ot,value:ot}))};case"date":return{field:z.variable,input_type:"DatePicker",label:z.name,default_value:z.default_value,required:z.is_required,attrs:{format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",type:"datetime"}};default:return console.warn(`未知的字段类型: ${z.type}, 使用默认配置`),{field:z.variable||z.name,input_type:"TextInput",label:z.name,default_value:z.default_value,required:z.is_required||!1}}}).filter(z=>z!==null);return console.log("最终映射的字段列表:",C),C});function V(){if(R.value.some(d=>d.id==="new"))Y.value.current_page=1,Y.value.total=0,ee.value=[];else{Y.value.current_page=1,Y.value.total=0,ee.value=[];const d={id:"new",abstract:"新建表单"};R.value.unshift(d)}b.value="new",x.value="新建表单",s.value=null,le.value=!1,oe.value=!1,S.value="-1",ue.value=null,v.value=!1,J()}function J(){c.value={},Z.value++,Me(()=>{console.log("应用默认值，字段列表:",L.value);const d={};L.value.forEach(h=>{console.log(`字段 ${h.field}: 默认值 = ${h.default_value}, 类型 = ${h.input_type}`),h.field&&h.default_value!==void 0&&h.default_value!==null&&h.default_value!==""&&(d[h.field]=h.default_value,console.log(`设置字段 ${h.field} 默认值为:`,h.default_value))}),c.value={...d},console.log("应用默认值后的formData:",c.value)})}async function ae(){var d;if(!v.value)try{(d=o.value)!=null&&d.validate&&await o.value.validate(),v.value=!0,le.value=!0,oe.value=!1,S.value="-1",s.value={status:"loading",content:"",write_ed:!1,is_stop:!1,timestamp:new Date};const h={application_id:k.value.id,form_data:c.value,type:"form_submission"};await xe(h),Me(()=>{ve()})}catch(h){console.error("Form submission error:",h),s.value={status:"error",error:h.message||"提交失败，请重试"}}finally{v.value=!1,le.value=!1,ue.value=null}}async function xe(d){try{const{default:h}=await nn(()=>import("./index-07dfdb25.js").then(K=>K.fG),["assets/index-07dfdb25.js","assets/index-9a4f3553.css"]),C=await h.getChatOpen(k.value.id);if(!C.data)throw new Error("无法获取聊天会话");const T=String(C.data.id||C.data);X.value=T;const M={message:ke(d.form_data),form_data:d.form_data,type:d.type||"form_submission"},re=await h.postChatMessage(T,M);return new Promise((K,fe)=>{var vt;if(re.status===401||re.status===460||re.status===461){fe(new Error(`API错误: ${re.status}`));return}const Oe=(vt=re.body)==null?void 0:vt.getReader();if(!Oe){fe(new Error("无法读取响应数据"));return}ue.value=Oe;let we="",Qe=!1,z=null;(async()=>{if(!Qe){Qe=!0;try{for(;;){if(oe.value){z&&(clearTimeout(z),z=null),s.value={status:"paused",content:we,timestamp:new Date},K({status:"paused",content:we});return}const{done:et,value:Rt}=await Oe.read();if(et){z&&(clearTimeout(z),z=null),le.value=!1;const We={status:"success",content:we,write_ed:!0,is_stop:!1,timestamp:new Date};s.value=We,Me(()=>{ve()});const _e=X.value;_e&&_e!=="new"&&(b.value=_e,x.value=$e(d.form_data),setTimeout(()=>{be()},1e3)),K(We);return}const nt=new TextDecoder().decode(Rt).split(`
`);for(const We of nt)if(We.startsWith("data: "))try{const _e=JSON.parse(We.slice(6));_e.content&&(we+=_e.content),_e.record_id&&(ie.value=_e.record_id),_e.chat_id&&(X.value=_e.chat_id)}catch{}we&&!z&&(z=setTimeout(()=>{s.value={status:"loading",content:we,timestamp:new Date},z=null,Me(()=>{ve()})},100))}}catch(et){z&&clearTimeout(z),fe(et)}finally{Qe=!1}}})().catch(fe)})}catch(h){throw console.error("Workflow API error:",h),le.value=!1,ue.value=null,new Error(h.message||"工作流程调用失败")}}function ke(d){const h=Object.keys(d);if(h.length===0)return"用户提交了一个空表单";let C=`客户：
`;return h.forEach(T=>{const M=L.value.find(fe=>fe.field===T),re=(M==null?void 0:M.label)||T,K=d[T];C+=`- ${re}: ${K}
`}),C}function $e(d){const h=Object.keys(d);if(h.length===0)return`表单提交 - ${new Date().toLocaleString()}`;const C=h[0],T=d[C];return`${String(T).slice(0,20)} - ${new Date().toLocaleString()}`}function Ce(d){try{const h=String(d||""),C=j(h);return typeof C=="string"?C:C&&typeof C.then=="function"?(console.warn("marked returned a Promise, using original content"),h):String(C)}catch(h){return console.error("formatAIResponse error:",h),String(d||"")}}async function me(){var d;if(!((d=s.value)!=null&&d.content)){se.warning("没有内容可复制");return}try{await navigator.clipboard.writeText(s.value.content),se.success("复制成功")}catch{try{const C=document.createElement("textarea");C.value=s.value.content,document.body.appendChild(C),C.select(),document.execCommand("copy"),document.body.removeChild(C),se.success("复制成功")}catch(C){console.error("Copy failed:",C),se.error("复制失败，请手动复制")}}}async function Ue(){var d;if(!((d=s.value)!=null&&d.content)){se.warning("没有内容可导出");return}try{const h=`表单结果-${Date.now()}.md`,C=`# ${x.value}

## 表单数据
${ke(c.value)}

## AI响应结果
${s.value.content}

`,T=new Blob([C],{type:"text/markdown;charset=utf-8"});Ct.saveAs(T,h),se.success("导出成功")}catch(h){console.error("Export markdown failed:",h),se.error("导出失败")}}async function Ze(){var d;if(!((d=s.value)!=null&&d.content)){se.warning("没有内容可导出");return}try{const h=`表单结果-${Date.now()}.html`,C=`# ${x.value}

## 表单数据
${ke(c.value)}

## AI响应结果
${s.value.content}

`,T=Ce(C),M=`<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${x.value}</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; }
    h1, h2, h3 { color: #2c3e50; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 4px; overflow-x: auto; }
    code { background: #f4f4f4; padding: 2px 4px; border-radius: 3px; }
    blockquote { border-left: 4px solid #3498db; margin: 0; padding-left: 20px; color: #666; }
  </style>
</head>
<body>
${T}
</body>
</html>`,re=new Blob([M],{type:"text/html;charset=utf-8"});Ct.saveAs(re,h.replace(".md",".html")),se.success("导出成功")}catch(h){console.error("Export HTML failed:",h),se.error("导出失败")}}function Ae(){ue.value&&(ue.value.cancel(),ue.value=null),oe.value=!0,le.value=!1,s.value&&(s.value.write_ed=!1,s.value.is_stop=!0,s.value.status="stopped"),v.value=!1,se.success("已停止生成")}function Ne(){oe.value=!1,Te()}async function Te(){if(!v.value)try{S.value="-1",await ae(),se.success("正在重新生成答案...")}catch(d){se.error(d.message||"重新生成失败")}}async function Re(d){if(!(P.value||!X.value||!ie.value)){P.value=!0;try{const{default:h}=await nn(()=>import("./index-07dfdb25.js").then(T=>T.fG),["assets/index-07dfdb25.js","assets/index-9a4f3553.css"]);await h.putChatVote(k.value.id,X.value,ie.value,d,P),S.value=d;const C=d==="0"?"点赞":d==="1"?"点踩":"取消评价";se.success(`${C}成功`)}catch(h){se.error(h.message||"操作失败")}finally{P.value=!1}}}function Se(d){E.value=d.id}function qe(d){console.log("点击历史记录:",d),Y.value.current_page=1,Y.value.total=0,ee.value=[],b.value=d.id,x.value=d.abstract||"表单提交",d.id==="new"?V():(console.log("获取聊天记录, chat_id:",d.id),W(),le.value=!1,oe.value=!1,ue.value=null)}function ze(d){var h;(h=l.value)==null||h.open(d,k.value.id)}function Ie(d,h){const C=R.value.find(T=>T.id===d);C&&(C.abstract=h,b.value===d&&(x.value=h))}function Ee(d){jn.confirm("确定要删除这条历史记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{if(d.id==="new"){se.warning("无法删除新建表单项");return}e.asyncDelChatClientLog(k.value.id,d.id,p).then(()=>{b.value===d.id&&(b.value="new",x.value="新建表单",s.value=null,c.value={}),be(),se.success("删除成功")}).catch(h=>{console.error("删除历史记录失败:",h),se.error("删除失败，请重试")})}).catch(()=>{})}function Le(d){if(I.value=d.scrollTop,i.value&&u.value){const h=u.value.scrollHeight,C=i.value.wrapRef.offsetHeight;h-(I.value+C)<=40?O.value=!0:O.value=!1}}function ve(){if(O.value&&i.value&&u.value)try{Me(()=>{var C,T,M;const d=((C=u.value)==null?void 0:C.scrollHeight)||0,h=((M=(T=i.value)==null?void 0:T.wrapRef)==null?void 0:M.offsetHeight)||0;console.log("AutoScroll - scrollHeight:",d,"containerHeight:",h),d>h&&(i.value.setScrollTop(d),console.log("AutoScroll - scrolled to bottom"))})}catch(d){console.error("AutoScroll error:",d)}}ft(()=>{J(),pe()});function pe(){var d;console.log("initFormHistory - showHistory:",F.value),console.log("applicationDetail:",k.value),console.log("applicationAvailable:",a.applicationAvailable),F.value?(console.log("开始加载表单历史记录..."),be()):console.log("历史记录被禁用 - show_history:",(d=k.value)==null?void 0:d.show_history,"isEnterprise:",t.isEnterprise(),"applicationAvailable:",a.applicationAvailable)}function be(){const d={current_page:1,page_size:20};e.asyncGetChatLogClient(k.value.id,d,p).then(h=>{console.log("API响应:",h),R.value=h.data.records||[],console.log("历史记录数量:",R.value.length),console.log("历史记录数据:",R.value);const C=ye();if(C&&R.value.find(T=>T.id===C)){b.value=C;const T=R.value.find(M=>M.id===C);T&&(x.value=T.abstract||"表单提交",W())}else R.value.length>0?(b.value=R.value[0].id,x.value=R.value[0].abstract||"表单提交",W()):(b.value="new",x.value="新建表单")}).catch(h=>{console.error("Failed to load form history:",h),R.value=[],b.value="new",x.value="新建表单"})}function W(){return e.asyncChatRecordLog(k.value.id,b.value,Y.value,r,!1).then(d=>{console.log("获取到的聊天记录:",d),Y.value.total=d.data.total;const h=d.data.records||[];if(h.map(C=>{C.write_ed=!0,C.record_id=C.id}),ee.value=[...h,...ee.value].sort((C,T)=>C.create_time.localeCompare(T.create_time)),console.log("处理后的记录列表:",ee.value),ee.value.length>0){const C=ee.value.filter(M=>M.problem_text).pop(),T=ee.value.filter(M=>M.answer_text).pop();if(C)try{if(C.problem_text.startsWith("{")){const M=JSON.parse(C.problem_text);c.value=M}else c.value={}}catch{console.log("无法解析表单数据，使用空表单"),c.value={}}T&&(s.value={status:"success",content:T.answer_text,write_ed:!0,is_stop:!1,timestamp:new Date(T.create_time)})}}).catch(d=>{console.error("获取聊天记录失败:",d)})}function ye(){try{const d=new URL(window.location.href);return d.searchParams.get("chat_id")||d.searchParams.get("form_id")}catch{return null}}return zn(()=>{var d;return(d=s.value)==null?void 0:d.content},d=>{d&&setTimeout(()=>{ve()},50)},{deep:!0,immediate:!0}),(d,h)=>{var Ut,Zt,Nt,Qt,Wt,Gt,Yt,Xt;const C=y("AppAvatar"),T=y("el-icon"),M=y("el-button"),re=y("auto-tooltip"),K=y("el-dropdown-item"),fe=y("el-dropdown-menu"),Oe=y("el-dropdown"),we=y("el-text"),Qe=y("common-list"),z=y("el-scrollbar"),ot=y("Promotion"),vt=y("el-empty"),et=y("el-card"),Rt=y("el-alert"),tt=y("el-tooltip"),nt=y("el-divider"),We=y("AppIcon"),_e=Ge("loading");return ce((A(),Q("div",{class:"chat-pc-form layout-bg",style:he({"--el-color-primary":(Zt=(Ut=k.value)==null?void 0:Ut.custom_theme)==null?void 0:Zt.theme_color,"--el-color-primary-light-9":U(Xe)((Qt=(Nt=k.value)==null?void 0:Nt.custom_theme)==null?void 0:Qt.theme_color,.1)})},[m("div",{class:"chat-pc-form__header",style:he(D.value)},[m("div",bo,[m("div",yo,[U(lt)((Wt=k.value)==null?void 0:Wt.icon)?(A(),B(C,{key:0,shape:"square",size:32,style:{background:"none"}},{default:_(()=>{var De;return[m("img",{src:(De=k.value)==null?void 0:De.icon,alt:""},null,8,wo)]}),_:1})):(Gt=k.value)!=null&&Gt.name?(A(),B(C,{key:1,name:(Yt=k.value)==null?void 0:Yt.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):q("",!0)]),m("h4",null,H((Xt=k.value)==null?void 0:Xt.name),1)])],4),m("div",xo,[m("div",$o,[F.value?(A(),Q("div",Co,[m("div",Ao,[f(M,{class:"add-button w-full primary",onClick:V},{default:_(()=>[f(T,null,{default:_(()=>[f(U(In))]),_:1}),h[5]||(h[5]=m("span",{class:"ml-4"},"新建表单",-1))]),_:1,__:[5]}),h[6]||(h[6]=m("p",{class:"mt-20 mb-8"},"历史记录",-1))]),m("div",To,[f(z,null,{default:_(()=>{var De,at,st,it;return[m("div",Ro,[ce((A(),B(Qe,{style:he({"--el-color-primary":(at=(De=k.value)==null?void 0:De.custom_theme)==null?void 0:at.theme_color,"--el-color-primary-light-9":U(Xe)((it=(st=k.value)==null?void 0:st.custom_theme)==null?void 0:it.theme_color,.1)}),data:R.value,class:"mt-8",defaultActive:b.value,onClick:qe,onMouseenter:Se,onMouseleave:h[1]||(h[1]=Pe=>E.value="")},{default:_(({row:Pe})=>[m("div",So,[f(re,{content:Pe.abstract},{default:_(()=>[te(H(Pe.abstract),1)]),_:2},1032,["content"]),ce(m("div",{onClick:h[0]||(h[0]=de(()=>{},["stop"]))},[f(Oe,{trigger:"click",teleported:!1},{dropdown:_(()=>[f(fe,null,{default:_(()=>[f(K,{onClick:de(gt=>ze(Pe),["stop"])},{default:_(()=>[f(T,null,{default:_(()=>[f(U(En))]),_:1}),h[7]||(h[7]=te(" 编辑 "))]),_:2,__:[7]},1032,["onClick"]),f(K,{onClick:de(gt=>Ee(Pe),["stop"])},{default:_(()=>[f(T,null,{default:_(()=>[f(U(Ln))]),_:1}),h[8]||(h[8]=te(" 删除 "))]),_:2,__:[8]},1032,["onClick"])]),_:2},1024)]),default:_(()=>[f(T,{class:"rotate-90 mt-4"},{default:_(()=>[f(U(Dn))]),_:1})]),_:2},1024)],512),[[Ye,E.value===Pe.id&&Pe.id!=="new"]])])]),empty:_(()=>[m("div",zo,[f(we,{type:"info"},{default:_(()=>h[9]||(h[9]=[te("暂无历史记录")])),_:1,__:[9]})])]),_:1},8,["style","data","defaultActive"])),[[_e,p.value]])])]}),_:1})])])):q("",!0),m("div",Io,[m("div",Eo,[m("h4",Lo,H(x.value),1),s.value?(A(),Q("span",Do,[f(T,{class:"info mr-8",style:{"font-size":"16px"}},{default:_(()=>[f(U(en))]),_:1}),h[10]||(h[10]=m("span",{class:"lighter"},"表单结果",-1))])):q("",!0)]),m("div",Po,[m("div",Mo,[m("div",Bo,[f(z,{class:"form-scrollbar"},{default:_(()=>[m("div",Ho,[f(et,{shadow:"never",class:"form-card"},{header:_(()=>[m("div",qo,[f(T,null,{default:_(()=>[f(U(en))]),_:1}),h[11]||(h[11]=m("span",{class:"ml-8"},"填写表单",-1))])]),default:_(()=>[L.value.length>0?(A(),Q("div",Oo,[(A(),B(Pn,{ref_key:"dynamicsFormRef",ref:o,modelValue:c.value,"onUpdate:modelValue":h[2]||(h[2]=De=>c.value=De),model:c.value,"label-position":"top","require-asterisk-position":"right",render_data:L.value,key:Z.value},null,8,["modelValue","model","render_data"])),m("div",Fo,[m("div",jo,[f(M,{type:"primary",size:"large",loading:v.value,onClick:ae,class:"flex-1"},{default:_(()=>[f(T,null,{default:_(()=>[f(ot)]),_:1}),h[12]||(h[12]=m("span",{class:"ml-8"},"提交表单",-1))]),_:1,__:[12]},8,["loading"]),f(M,{size:"large",onClick:J,disabled:v.value,class:"flex-1"},{default:_(()=>[f(T,null,{default:_(()=>[f(U(Mn))]),_:1}),h[13]||(h[13]=m("span",{class:"ml-8"},"重置",-1))]),_:1,__:[13]},8,["disabled"])])])])):(A(),Q("div",Vo,[f(vt,{"image-size":80,description:"暂无表单字段配置"})]))]),_:1})])]),_:1})]),m("div",Uo,[f(z,{ref_key:"scrollbarRef",ref:i,onScroll:Le},{default:_(()=>{var De,at,st,it,Pe,gt,Jt,Kt;return[m("div",{class:"p-16",ref_key:"scrollContentRef",ref:u},[s.value?(A(),Q("div",Zo,[m("div",No,[$.value?(A(),Q("div",Qo,[(De=k.value)!=null&&De.avatar?(A(),Q("img",{key:0,src:k.value.avatar,height:"28px",width:"28px"},null,8,Wo)):(at=k.value)!=null&&at.name?(A(),B(C,{key:1,name:k.value.name,pinyinColor:"",shape:"square",size:28},null,8,["name"])):q("",!0)])):q("",!0),m("div",Go,[f(et,{shadow:"always",class:"mb-8 border-r-8",style:{"--el-card-padding":"6px 16px"}},{default:_(()=>[s.value.status==="loading"?(A(),Q(It,{key:0},[h[14]||(h[14]=m("p",{style:{margin:"0.5rem 0"}},[te(" AI正在处理您的表单... "),m("span",{class:"dotting"})],-1)),s.value.content?(A(),B(tn,{key:0,source:s.value.content,disabled:!0},null,8,["source"])):q("",!0)],64)):s.value.status==="success"?(A(),B(tn,{key:1,source:s.value.content||"",disabled:!1},null,8,["source"])):s.value.status==="error"?(A(),B(Rt,{key:2,type:"error",title:"处理失败",description:s.value.error||"未知错误","show-icon":"",closable:!1},null,8,["description"])):q("",!0)]),_:1})])]),m("div",Yo,[m("div",Xo,[oe.value&&!((st=s.value)!=null&&st.write_ed)||!((it=s.value)!=null&&it.write_ed)&&le.value?(A(),Q("div",Jo,[oe.value&&!((Pe=s.value)!=null&&Pe.write_ed)?(A(),B(M,{key:0,type:"primary",onClick:Ne,link:""},{default:_(()=>[te(H(d.$t("chat.operation.continue")||"继续"),1)]),_:1})):!((gt=s.value)!=null&&gt.write_ed)&&le.value?(A(),B(M,{key:1,type:"primary",onClick:Ae,link:""},{default:_(()=>[te(H(d.$t("chat.operation.stopChat")||"停止生成"),1)]),_:1})):q("",!0)])):q("",!0),ce(m("div",Ko,[m("div",null,[s.value.timestamp?(A(),B(we,{key:0,type:"info"},{default:_(()=>[m("span",ea,H(U(Bn)(s.value.timestamp)),1)]),_:1})):q("",!0)]),m("div",ta,[s.value.content?(A(),B(tt,{key:0,effect:"dark",content:"复制",placement:"top"},{default:_(()=>[f(M,{text:"",onClick:me},{default:_(()=>[f(T,null,{default:_(()=>[f(U(Hn))]),_:1})]),_:1})]),_:1})):q("",!0),s.value.content?(A(),B(nt,{key:1,direction:"vertical"})):q("",!0),s.value.status==="success"||s.value.status==="paused"?(A(),B(tt,{key:2,effect:"dark",content:"换个答案",placement:"top"},{default:_(()=>[f(M,{text:"",onClick:Te,disabled:v.value},{default:_(()=>[f(T,null,{default:_(()=>[f(U(qn))]),_:1})]),_:1},8,["disabled"])]),_:1})):q("",!0),s.value.status==="success"||s.value.status==="paused"?(A(),B(nt,{key:3,direction:"vertical"})):q("",!0),s.value.status==="success"?(A(),Q(It,{key:4},[f(tt,{effect:"dark",content:S.value==="0"?"取消点赞":"点赞",placement:"top"},{default:_(()=>[f(M,{text:"",onClick:h[3]||(h[3]=An=>Re(S.value==="0"?"-1":"0")),disabled:P.value,class:dt({"is-active":S.value==="0"})},{default:_(()=>[f(We,{iconName:S.value==="0"?"app-like-color":"app-like"},null,8,["iconName"])]),_:1},8,["disabled","class"])]),_:1},8,["content"]),f(nt,{direction:"vertical"}),f(tt,{effect:"dark",content:S.value==="1"?"取消点踩":"点踩",placement:"top"},{default:_(()=>[f(M,{text:"",onClick:h[4]||(h[4]=An=>Re(S.value==="1"?"-1":"1")),disabled:P.value,class:dt({"is-active":S.value==="1"})},{default:_(()=>[f(We,{iconName:S.value==="1"?"app-oppose-color":"app-oppose"},null,8,["iconName"])]),_:1},8,["disabled","class"])]),_:1},8,["content"]),f(nt,{direction:"vertical"})],64)):q("",!0),s.value.content&&s.value.status==="success"?(A(),B(Oe,{key:5},{dropdown:_(()=>[f(fe,null,{default:_(()=>[f(K,{onClick:Ue},{default:_(()=>h[15]||(h[15]=[te("导出 Markdown")])),_:1,__:[15]}),f(K,{onClick:Ze},{default:_(()=>h[16]||(h[16]=[te("导出 HTML")])),_:1,__:[16]})]),_:1})]),default:_(()=>[f(tt,{effect:"dark",content:"导出",placement:"top"},{default:_(()=>[f(M,{text:""},{default:_(()=>[f(T,null,{default:_(()=>[f(U(On))]),_:1}),f(T,{class:"el-icon--right"},{default:_(()=>[f(U(Fn))]),_:1})]),_:1})]),_:1})]),_:1})):q("",!0)])],512),[[Ye,((Jt=s.value)==null?void 0:Jt.write_ed)&&((Kt=s.value)==null?void 0:Kt.status)!=="error"]])])])])):q("",!0)],512)]}),_:1},512)])])])])])]),f(hn,{ref_key:"EditTitleDialogRef",ref:l,onRefresh:Ie},null,512)],4)),[[_e,r.value]])}}});const la=Mt(na,[["__scopeId","data-v-94e27814"]]),oa=Object.freeze(Object.defineProperty({__proto__:null,default:la},Symbol.toStringTag,{value:"Module"})),aa=768,sa=()=>{const{common:g}=Ve(),t=()=>{var a;return((a=document.body)==null?void 0:a.getBoundingClientRect()).width-1<aa},e=()=>{if(!document.hidden){const n=t();g.toggleDevice(n?zt.Mobile:zt.Desktop)}};pn(()=>{window.addEventListener("resize",e)}),ft(()=>{Me(()=>{t()&&g.toggleDevice(zt.Mobile)})}),Vn(()=>{window.removeEventListener("resize",e)})},ia={class:"flex align-center"},ra={class:"mr-12 ml-24 flex"},ca=["src"],ua={class:"flex"},pa={class:"chat-pc__left border-r"},da={class:"p-24 pb-0"},ha={class:"ml-4"},fa={class:"mt-20 mb-8"},_a={class:"left-height pt-0"},ma={class:"p-8 pt-0"},va={class:"flex-between"},ga={class:"text-center"},ka={key:0,class:"gradient-divider lighter mt-8"},ba={class:"chat-pc__right"},ya={class:"right-header border-b mb-24 p-16-24 flex-between"},wa={class:"ellipsis-1",style:{width:"66%"}},xa={key:0,class:"flex align-center"},$a={key:1,class:"lighter"},Ca={class:"right-height chat-width"},Aa={class:"flex",style:{height:"100%"}},Ta={class:"chat-content",style:{flex:"1"}},Ra={class:"collapse"},Sa=je({__name:"index",props:{application_profile:{},applicationAvailable:{type:Boolean}},setup(g){sa();const{user:t,log:e,common:n}=Ve(),a=w(),o=w(!1),l=ne(()=>{var $,L,V,J;return{background:(L=($=s.value)==null?void 0:$.custom_theme)==null?void 0:L.theme_color,color:(J=(V=s.value)==null?void 0:V.custom_theme)==null?void 0:J.header_font_color}}),i=ne(()=>({mobile:n.isMobile(),hideLeft:!o.value,openLeft:o.value})),u={id:"new",abstract:Fe("chat.createChat")},r=g,p=w(),v=w(!1),c=w(!1),s=ne({get:()=>r.application_profile,set:$=>{}}),b=w([]),x=w({current_page:1,page_size:20,total:0}),E=w([]),R=w("new"),S=w(Fe("chat.createChat")),P=w("");function Z($){P.value=$.id}function X($){a.value.open($,s.value.id)}function ie($,L){const V=b.value.find(J=>J.id==$);V&&(V.abstract=L)}function Y($){e.asyncDelChatClientLog(s.value.id,$.id,c).then(()=>{R.value===$.id&&(R.value="new",S.value=Fe("chat.createChat"),x.value.current_page=1,x.value.total=0,E.value=[]),oe(s.value.id)})}function ee($){if(R.value!=="new"&&$.scrollTop===0&&x.value.total>E.value.length){const L=$.dialogScrollbar.offsetHeight;x.value.current_page+=1,ue().then(()=>{$.scrollDiv.setScrollTop($.dialogScrollbar.offsetHeight-L)})}}function le(){b.value.some($=>$.id==="new")?(x.value.current_page=1,x.value.total=0,E.value=[]):(x.value.current_page=1,x.value.total=0,E.value=[],b.value.unshift(u)),R.value="new",S.value=Fe("chat.createChat"),n.isMobile()&&(o.value=!1)}function oe($,L){const V={current_page:1,page_size:20};e.asyncGetChatLogClient($,V,c).then(J=>{var ae,xe,ke,$e,Ce,me;b.value=J.data.records,L?S.value=(xe=(ae=b.value)==null?void 0:ae[0])==null?void 0:xe.abstract:(x.value.current_page=1,x.value.total=0,E.value=[],R.value=(($e=(ke=b.value)==null?void 0:ke[0])==null?void 0:$e.id)||"new",S.value=((me=(Ce=b.value)==null?void 0:Ce[0])==null?void 0:me.abstract)||Fe("chat.createChat"),R.value!=="new"&&ue())})}function ue(){return e.asyncChatRecordLog(s.value.id,R.value,x.value,v,!1).then($=>{x.value.total=$.data.total;const L=$.data.records;L.map(V=>{V.write_ed=!0,V.record_id=V.id}),E.value=[...L,...E.value].sort((V,J)=>V.create_time.localeCompare(J.create_time)),x.value.current_page===1&&Me(()=>{p.value.setScrollBottom()})})}const I=$=>{$.id!==R.value&&(x.value.current_page=1,x.value.total=0,E.value=[],R.value=$.id,S.value=$.abstract,R.value!=="new"&&(ue(),window.speechSynthesis.paused&&window.speechSynthesis.speaking&&(window.speechSynthesis.resume(),Me(()=>{window.speechSynthesis.cancel()})))),n.isMobile()&&(o.value=!1)};function O($){oe(s.value.id,!0),R.value=$}async function k(){const $=`${R.value}.md`,L=E.value.map(J=>`# ${J.problem_text}

${J.answer_text}

`).join(`
`),V=new Blob([L],{type:"text/markdown;charset=utf-8"});Ct.saveAs(V,$)}async function D(){const $=`${R.value}.html`,L=E.value.map(ae=>`# ${ae.problem_text}

${ae.answer_text}

`).join(`
`),V=j(L),J=new Blob([V],{type:"text/html;charset=utf-8"});Ct.saveAs(J,$)}const F=()=>{(s.value.show_history||!t.isEnterprise())&&r.applicationAvailable&&oe(s.value.id)};return ft(()=>{F()}),($,L)=>{var Ie,Ee,Le,ve,pe,be,W,ye,d;const V=y("AppAvatar"),J=y("Plus"),ae=y("el-icon"),xe=y("el-button"),ke=y("auto-tooltip"),$e=y("MoreFilled"),Ce=y("EditPen"),me=y("el-dropdown-item"),Ue=y("Delete"),Ze=y("el-dropdown-menu"),Ae=y("el-dropdown"),Ne=y("el-text"),Te=y("common-list"),Re=y("el-scrollbar"),Se=y("AppIcon"),qe=y("AiChat"),ze=Ge("loading");return ce((A(),Q("div",{class:dt(["chat-pc layout-bg",i.value]),style:he({"--el-color-primary":(Ee=(Ie=s.value)==null?void 0:Ie.custom_theme)==null?void 0:Ee.theme_color,"--el-color-primary-light-9":U(Xe)((ve=(Le=s.value)==null?void 0:Le.custom_theme)==null?void 0:ve.theme_color,.1)})},[m("div",{class:"chat-pc__header",style:he(l.value)},[m("div",ia,[m("div",ra,[U(lt)((pe=s.value)==null?void 0:pe.icon)?(A(),B(V,{key:0,shape:"square",size:32,style:{background:"none"}},{default:_(()=>{var h;return[m("img",{src:(h=s.value)==null?void 0:h.icon,alt:""},null,8,ca)]}),_:1})):(be=s.value)!=null&&be.name?(A(),B(V,{key:1,name:(W=s.value)==null?void 0:W.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):q("",!0)]),m("h4",null,H((ye=s.value)==null?void 0:ye.name),1)])],4),m("div",null,[m("div",ua,[m("div",pa,[m("div",da,[f(xe,{class:"add-button w-full primary",onClick:le},{default:_(()=>[f(ae,null,{default:_(()=>[f(J)]),_:1}),m("span",ha,H($.$t("chat.createChat")),1)]),_:1}),m("p",fa,H($.$t("chat.history")),1)]),m("div",_a,[f(Re,null,{default:_(()=>{var h,C,T,M,re;return[m("div",ma,[ce((A(),B(Te,{style:he({"--el-color-primary":(C=(h=s.value)==null?void 0:h.custom_theme)==null?void 0:C.theme_color,"--el-color-primary-light-9":U(Xe)((M=(T=s.value)==null?void 0:T.custom_theme)==null?void 0:M.theme_color,.1)}),data:b.value,class:"mt-8",defaultActive:R.value,onClick:I,onMouseenter:Z,onMouseleave:L[1]||(L[1]=K=>P.value="")},{default:_(({row:K})=>[m("div",va,[f(ke,{content:K.abstract},{default:_(()=>[te(H(K.abstract),1)]),_:2},1032,["content"]),ce(m("div",{onClick:L[0]||(L[0]=de(()=>{},["stop"]))},[f(Ae,{trigger:"click",teleported:!1},{dropdown:_(()=>[f(Ze,null,{default:_(()=>[f(me,{onClick:de(fe=>X(K),["stop"])},{default:_(()=>[f(ae,null,{default:_(()=>[f(Ce)]),_:1}),te(" "+H($.$t("common.edit")),1)]),_:2},1032,["onClick"]),f(me,{onClick:de(fe=>Y(K),["stop"])},{default:_(()=>[f(ae,null,{default:_(()=>[f(Ue)]),_:1}),te(" "+H($.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:_(()=>[f(ae,{class:"rotate-90 mt-4"},{default:_(()=>[f($e)]),_:1})]),_:2},1024)],512),[[Ye,P.value===K.id&&K.id!=="new"]])])]),empty:_(()=>[m("div",ga,[f(Ne,{type:"info"},{default:_(()=>[te(H($.$t("chat.noHistory")),1)]),_:1})])]),_:1},8,["style","data","defaultActive"])),[[ze,c.value]])]),(re=b.value)!=null&&re.length?(A(),Q("div",ka,[m("span",null,H($.$t("chat.only20history")),1)])):q("",!0)]}),_:1})])]),m("div",ba,[m("div",ya,[m("h4",wa,H(S.value),1),E.value.length?(A(),Q("span",xa,[x.value.total?(A(),B(Se,{key:0,iconName:"app-chat-record",class:"info mr-8",style:{"font-size":"16px"}})):q("",!0),x.value.total?(A(),Q("span",$a,H(x.value.total)+" "+H($.$t("chat.question_count")),1)):q("",!0),f(Ae,{class:"ml-8"},{dropdown:_(()=>[f(Ze,null,{default:_(()=>[f(me,{onClick:k},{default:_(()=>[te(H($.$t("common.export"))+" Markdown",1)]),_:1}),f(me,{onClick:D},{default:_(()=>[te(H($.$t("common.export"))+" HTML",1)]),_:1})]),_:1})]),default:_(()=>[f(Se,{iconName:"app-export",class:"cursor",title:$.$t("chat.exportRecords")},null,8,["title"])]),_:1})])):q("",!0)]),m("div",Ca,[m("div",Aa,[m("div",Ta,[f(qe,{ref_key:"AiChatRef",ref:p,applicationDetails:s.value,"onUpdate:applicationDetails":L[2]||(L[2]=h=>s.value=h),available:$.applicationAvailable,type:"ai-chat",appId:(d=s.value)==null?void 0:d.id,record:E.value,chatId:R.value,onRefresh:O,onScroll:ee},null,8,["applicationDetails","available","appId","record","chatId"])])])])])]),m("div",Ra,[f(xe,{onClick:L[3]||(L[3]=h=>o.value=!o.value)},{default:_(()=>[f(ae,null,{default:_(()=>[(A(),B(Pt(o.value?"Fold":"Expand")))]),_:1})]),_:1})])]),f(hn,{ref_key:"EditTitleDialogRef",ref:a,onRefresh:ie},null,512)],6)),[[ze,v.value]])}}});const za=Object.freeze(Object.defineProperty({__proto__:null,default:Sa},Symbol.toStringTag,{value:"Module"})),Ia=je({__name:"index",setup(g){const{locale:t}=Un({useScope:"global"}),e=Dt(),{application:n,user:a}=Ve(),o=Object.assign({"/src/views/chat/auth/index.vue":Jn,"/src/views/chat/base/index.vue":sl,"/src/views/chat/embed/index.vue":yl,"/src/views/chat/index.vue":Nn,"/src/views/chat/mobile/index.vue":Ml,"/src/views/chat/pc-form/index.vue":oa,"/src/views/chat/pc/index.vue":za}),{query:{mode:l},params:{accessToken:i}}=e,u=w(!1),r=ne(()=>{let S="";!l||l==="pc"?S=c.value||!a.isEnterprise()?"pc":"base":l==="pc-form"?S="pc-form":S=l;const P=`/src/views/chat/${S}/index.vue`;return o[P].default}),p=ne(()=>{if(b.value){if(!x.value)return!0;if(s.value){if(s.value.authentication&&u.value)return!0;if(!s.value.authentication)return!0}}return!1}),v=w(!1),c=w(!1),s=w({}),b=w(!1),x=w(!0);function E(){return n.asyncGetAppProfile(v).then(S=>{var P,Z;t.value=((P=S.data)==null?void 0:P.language)||Zn(),c.value=(Z=S.data)==null?void 0:Z.show_history,s.value=S.data})}function R(S){return n.asyncAppAuthentication(S,v).then(()=>E())}return pn(()=>{a.changeUserType(2,i),Promise.all([a.asyncGetProfile(),R(i)]).catch(()=>{x.value=!1}).finally(()=>b.value=!0)}),(S,P)=>{var X,ie,Y,ee;const Z=Ge("loading");return p.value&&b.value?ce((A(),B(Pt(r.value),{applicationAvailable:x.value,application_profile:s.value,key:U(e).fullPath},null,8,["applicationAvailable","application_profile"])),[[Z,v.value]]):(A(),B(dn,{key:1,application_profile:s.value,auth_type:s.value.authentication_type,modelValue:u.value,"onUpdate:modelValue":P[0]||(P[0]=le=>u.value=le),style:he({"--el-color-primary":(ie=(X=s.value)==null?void 0:X.custom_theme)==null?void 0:ie.theme_color,"--el-color-primary-light-9":U(Xe)((ee=(Y=s.value)==null?void 0:Y.custom_theme)==null?void 0:ee.theme_color,.1)})},null,8,["application_profile","auth_type","modelValue","style"]))}}});export{Ia as default};
