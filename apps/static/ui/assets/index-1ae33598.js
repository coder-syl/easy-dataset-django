import{cp as ue,dz as pe,cq as p,cr as F,ct as _e,cu as n,cU as me,cx as _,cy as f,cz as t,cA as a,cB as s,cK as r,cJ as i,cv as z,dI as ve,ej as fe,cF as k,cH as he,cC as ge,cD as ye,cV as $,cN as A,dg as be,cw as J,et as we,eu as ke,cT as Q,cZ as $e,dh as Ce,ev as xe,ew as Z,cQ as Ve,cR as De}from"./index-07dfdb25.js";import{_ as Te}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-1e0b193e.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-2937403a.js";const Se="/ui/assets/hit-test-empty-4afe2647.png",Fe={class:"hit-test"},ze={class:"hit-test__main p-16"},Ae={class:"avatar"},Re={class:"content"},Ie={class:"text break-all"},Ne={class:"hit-test-height"},qe={class:"active-button primary"},Be={class:"footer-content flex-between"},Ke={key:0},He={key:0},Pe={key:1,class:"ml-4"},Me={class:"hit-test__operate p-24 pt-0"},Ue={class:"mb-16"},Le={class:"title mb-8"},je={class:"mb-4"},Ee={class:"mb-4"},Je={class:"mb-4"},Qe={class:"mb-16"},Ze={class:"title mb-8"},Ge={class:"mb-16"},Oe={class:"title mb-8"},We={class:"text-right"},Xe={class:"operate-textarea flex"},Ye={class:"operate"},et={src:we,alt:""},tt={src:ke,alt:""},at=ue({__name:"index",setup(ot){const G=pe(),{meta:{activeMenu:R},params:{id:I}}=G,N=p(),q=p(),m=p(!1),v=p([]),B=p(""),d=p(""),C=p({similarity:.6,top_number:5,search_mode:"embedding"}),x=p(!0),c=p({}),h=p(!1),g=p(""),y=F(()=>!d.value),O=F(()=>R.includes("application")),W=F(()=>R.includes("dataset"));function X(e){e==="keywords"?c.value.similarity=0:c.value.similarity=.6}function K(e){e==="open"?(h.value=!0,c.value=Q.cloneDeep(C.value)):e==="close"&&(h.value=!1,C.value=Q.cloneDeep(c.value))}function Y(e){B.value=$e("views.paragraph.paragraphDetail"),q.value.open(e)}function H(e){!(e!=null&&e.ctrlKey)&&!(e!=null&&e.shiftKey)&&!(e!=null&&e.altKey)&&!(e!=null&&e.metaKey)?(e.preventDefault(),!y.value&&!m.value&&P()):ee(e)}const ee=e=>{const o=N.value.$el.querySelector(".el-textarea__inner"),u=o.selectionStart,b=o.selectionEnd;e.preventDefault(),d.value=d.value.slice(0,u)+`
`+d.value.slice(b),Ce(()=>{o.setSelectionRange(u+1,u+1)})};function P(){const e={query_text:d.value,...C.value};W.value?xe.getDatasetHitTest(I,e,m).then(o=>{v.value=o.data&&Z(o.data,"comprehensive_score",!0),g.value=d.value,d.value="",x.value=!1}):O.value&&Ve.getApplicationHitTest(I,e,m).then(o=>{v.value=o.data&&Z(o.data,"comprehensive_score",!0),g.value=d.value,d.value="",x.value=!1})}function te(e){if(e){const o=v.value.filter(u=>u.id===e.id)[0];o.content=e.content,o.title=e.title}else v.value=[],P()}return _e(()=>{}),(e,o)=>{const u=n("el-text"),b=n("AppAvatar"),M=n("el-empty"),ae=n("Document"),oe=n("el-icon"),U=n("AppIcon"),le=n("CardBox"),V=n("el-col"),L=n("el-row"),se=n("el-scrollbar"),ie=n("LayoutContainer"),w=n("el-button"),D=n("el-radio"),T=n("el-card"),ne=n("el-radio-group"),j=n("el-input-number"),ce=n("el-popover"),re=n("el-input"),de=me("loading");return _(),f("div",Fe,[t(ie,null,{header:a(()=>[s("h4",null,[r(i(e.$t("views.application.hitTest.title"))+" ",1),t(u,{type:"info",class:"ml-4"},{default:a(()=>[r(i(e.$t("views.application.hitTest.text")),1)]),_:1})])]),default:a(()=>[z((_(),f("div",ze,[s("div",{class:"question-title",style:ve({visibility:g.value?"visible":"hidden"})},[s("div",Ae,[t(b,null,{default:a(()=>o[8]||(o[8]=[s("img",{src:fe,style:{width:"54%"},alt:""},null,-1)])),_:1,__:[8]})]),s("div",Re,[s("h4",Ie,i(g.value),1)])],4),t(se,null,{default:a(()=>[s("div",Ne,[x.value?(_(),k(M,{key:0,image:he(Se),description:e.$t("views.application.hitTest.emptyMessage1"),style:{"padding-top":"160px"},"image-size":125},null,8,["image","description"])):v.value.length==0?(_(),k(M,{key:1,description:e.$t("views.application.hitTest.emptyMessage2"),style:{"padding-top":"160px"},"image-size":125},null,8,["description"])):(_(),k(L,{key:2},{default:a(()=>[(_(!0),f(ge,null,ye(v.value,(l,E)=>(_(),k(V,{xs:24,sm:12,md:12,lg:8,xl:6,key:E,class:"p-8"},{default:a(()=>[t(le,{shadow:"hover",title:l.title||"-",description:l.content,class:$(["document-card layout-bg layout-bg cursor",l.is_active?"":"disabled"]),showIcon:!1,onClick:S=>Y(l)},{icon:a(()=>[t(b,{class:"mr-12 avatar-light",size:22},{default:a(()=>[r(i(E+1+""),1)]),_:2},1024)]),footer:a(()=>[s("div",Be,[t(u,null,{default:a(()=>[t(oe,null,{default:a(()=>[t(ae)]),_:1}),r(" "+i(l==null?void 0:l.document_name),1)]),_:2},1024),l.trample_num||l.star_num?(_(),f("div",Ke,[l.star_num?(_(),f("span",He,[t(U,{iconName:"app-like-color"}),r(" "+i(l.star_num),1)])):A("",!0),l.trample_num?(_(),f("span",Pe,[t(U,{iconName:"app-oppose-color"}),r(" "+i(l.trample_num),1)])):A("",!0)])):A("",!0)])]),default:a(()=>{var S;return[s("div",qe,i((S=l.similarity)==null?void 0:S.toFixed(3)),1)]}),_:2},1032,["title","description","class","onClick"])]),_:2},1024))),128))]),_:1}))])]),_:1})])),[[de,m.value]]),t(Te,{ref_key:"ParagraphDialogRef",ref:q,title:B.value,onRefresh:te},null,8,["title"])]),_:1}),s("div",Me,[t(ce,{visible:h.value,placement:"right-end",width:500,trigger:"click"},{reference:a(()=>[t(w,{icon:"Setting",class:"mb-8",onClick:o[0]||(o[0]=l=>K("open"))},{default:a(()=>[r(i(e.$t("common.paramSetting")),1)]),_:1})]),default:a(()=>[s("div",Ue,[s("div",Le,i(e.$t("views.application.applicationForm.dialog.selectSearchMode")),1),t(ne,{modelValue:c.value.search_mode,"onUpdate:modelValue":o[1]||(o[1]=l=>c.value.search_mode=l),class:"card__radio",onChange:X},{default:a(()=>[t(T,{shadow:"never",class:$(["mb-16",c.value.search_mode==="embedding"?"active":""])},{default:a(()=>[t(D,{value:"embedding",size:"large"},{default:a(()=>[s("p",je,i(e.$t("views.application.applicationForm.dialog.vectorSearch")),1),t(u,{type:"info"},{default:a(()=>[r(i(e.$t("views.application.applicationForm.dialog.vectorSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"]),t(T,{shadow:"never",class:$(["mb-16",c.value.search_mode==="keywords"?"active":""])},{default:a(()=>[t(D,{value:"keywords",size:"large"},{default:a(()=>[s("p",Ee,i(e.$t("views.application.applicationForm.dialog.fullTextSearch")),1),t(u,{type:"info"},{default:a(()=>[r(i(e.$t("views.application.applicationForm.dialog.fullTextSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"]),t(T,{shadow:"never",class:$(["mb-16",c.value.search_mode==="blend"?"active":""])},{default:a(()=>[t(D,{value:"blend",size:"large"},{default:a(()=>[s("p",Je,i(e.$t("views.application.applicationForm.dialog.hybridSearch")),1),t(u,{type:"info"},{default:a(()=>[r(i(e.$t("views.application.applicationForm.dialog.hybridSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"])]),t(L,{gutter:20},{default:a(()=>[t(V,{span:12},{default:a(()=>[s("div",Qe,[s("div",Ze,i(e.$t("views.application.applicationForm.dialog.similarityThreshold")),1),t(j,{modelValue:c.value.similarity,"onUpdate:modelValue":o[2]||(o[2]=l=>c.value.similarity=l),min:0,max:c.value.search_mode==="blend"?2:1,precision:3,step:.1,"value-on-clear":0,"controls-position":"right",class:"w-full"},null,8,["modelValue","max"])])]),_:1}),t(V,{span:12},{default:a(()=>[s("div",Ge,[s("div",Oe,i(e.$t("views.application.applicationForm.dialog.topReferences")),1),t(j,{modelValue:c.value.top_number,"onUpdate:modelValue":o[3]||(o[3]=l=>c.value.top_number=l),min:1,max:1e4,"controls-position":"right",class:"w-full"},null,8,["modelValue"])])]),_:1})]),_:1}),s("div",We,[t(w,{onClick:o[4]||(o[4]=l=>h.value=!1)},{default:a(()=>[r(i(e.$t("common.cancel")),1)]),_:1}),t(w,{type:"primary",onClick:o[5]||(o[5]=l=>K("close"))},{default:a(()=>[r(i(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"]),s("div",Xe,[t(re,{ref_key:"quickInputRef",ref:N,modelValue:d.value,"onUpdate:modelValue":o[6]||(o[6]=l=>d.value=l),type:"textarea",placeholder:e.$t("common.inputPlaceholder"),autosize:{minRows:1,maxRows:8},onKeydown:o[7]||(o[7]=be(l=>H(l),["enter"]))},null,8,["modelValue","placeholder"]),s("div",Ye,[t(w,{text:"",class:"sent-button",disabled:y.value||m.value,onClick:H},{default:a(()=>[z(s("img",et,null,512),[[J,y.value||m.value]]),z(s("img",tt,null,512),[[J,!y.value&&!m.value]])]),_:1},8,["disabled"])])])])])}}});const nt=De(at,[["__scopeId","data-v-5167f13c"]]);export{nt as default};
