import{cp as le,dB as ie,d1 as pe,cZ as s,cq as _,d3 as se,d0 as Fe,cu as l,cx as f,cF as C,cA as n,cB as y,cz as t,cE as x,cK as k,cJ as v,cT as De,eb as ce,ec as re,ed as Ne,cQ as D,dj as de,cP as Q,ct as Te,cU as Ue,cy as E,cC as oe,cD as te,cv as Be,cH as J,dE as Se,cN as ae,ee as Pe,cY as ne,c_ as K,cR as Me}from"./index-07dfdb25.js";const Re={class:"dialog-footer"},ze=le({__name:"CopyApplicationDialog",setup(ue,{expose:P}){const A=ie(),{common:g,user:q}=pe(),N=s("views.application.applicationForm.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),T=_(),V=_(!1),d=_(!1),u=_({name:"",desc:"",model_id:"",dialogue_number:0,prologue:s("views.application.applicationForm.form.defaultPrologue"),dataset_id_list:[],dataset_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:N},problem_optimization:!1,type:"SIMPLE"}),h=se({name:[{required:!0,message:s("views.application.applicationForm.form.appName.placeholder"),trigger:"blur"}]});Fe(d,c=>{var i;c||(u.value={name:"",desc:"",model_id:"",dialogue_number:0,prologue:s("views.application.applicationForm.form.defaultPrologue"),dataset_id_list:[],dataset_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:N},problem_optimization:!1,type:"SIMPLE"},(i=T.value)==null||i.clearValidate())});const U=c=>{const i=De.cloneDeep(c);delete i.id,i.name=i.name+` ${s("views.application.applicationForm.title.copy")}`,u.value=i,d.value=!0},b=c=>{q.isEnterprise()?I(c):g.asyncGetValid(ce.Application,re.Application,V).then(async i=>{i!=null&&i.data?I(c):Ne(s("common.tip"),s("views.application.tip.professionalMessage"))})},I=async c=>{c&&await c.validate(i=>{i&&D.postApplication(u.value,V).then($=>{de(s("common.createSuccess")),Q(u.value.type)?A.push({path:`/application/${$.data.id}/workflow`}):A.push({path:`/application/${$.data.id}/${$.data.type}/setting`}),d.value=!1})})};return P({open:U}),(c,i)=>{const $=l("el-input"),M=l("el-form-item"),L=l("el-form"),R=l("el-button"),G=l("el-dialog");return f(),C(G,{title:c.$t("views.application.copyApplication"),modelValue:d.value,"onUpdate:modelValue":i[4]||(i[4]=w=>d.value=w),width:"650","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[y("span",Re,[t(R,{onClick:i[2]||(i[2]=x(w=>d.value=!1,["prevent"])),loading:V.value},{default:n(()=>[k(v(c.$t("common.cancel")),1)]),_:1},8,["loading"]),t(R,{type:"primary",onClick:i[3]||(i[3]=w=>b(T.value)),loading:V.value},{default:n(()=>[k(v(c.$t("common.copy")),1)]),_:1},8,["loading"])])]),default:n(()=>[t(L,{ref_key:"applicationFormRef",ref:T,model:u.value,rules:h,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[t(M,{label:c.$t("views.application.applicationForm.form.appName.label"),prop:"name"},{default:n(()=>[t($,{modelValue:u.value.name,"onUpdate:modelValue":i[0]||(i[0]=w=>u.value.name=w),maxlength:"64",placeholder:c.$t("views.application.applicationForm.form.appName.placeholder"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(M,{label:c.$t("views.application.applicationForm.form.appDescription.label")},{default:n(()=>[t($,{modelValue:u.value.desc,"onUpdate:modelValue":i[1]||(i[1]=w=>u.value.desc=w),type:"textarea",placeholder:c.$t("views.application.applicationForm.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),Ee={class:"application-list-container p-24",style:{"padding-top":"16px"}},qe={class:"flex-between mb-16"},Le={class:"flex-between"},Ge={class:"flex align-center cursor p-8"},He=["src"],Oe={class:"status-tag"},je={class:"footer-content"},Je=le({__name:"index",setup(ue){const P=_(),{application:A,user:g,common:q}=pe(),N=ie(),T=_(),V=_(),d=_(!1),u=_([]),h=se({current_page:1,page_size:30,total:0}),U=_([]),b=_("all"),I=_(""),c=_([]);function i(e){A.asyncGetApplicationDetail(e.id,d).then(o=>{o!=null&&o.data&&T.value.open({...o.data,model_id:o.data.model})})}const $=e=>g.userInfo?g.userInfo.id==e.user_id:!1;function M(e){Q(e.type)?N.push({path:`/application/${e.id}/workflow`}):N.push({path:`/application/${e.id}/${e.type}/setting`})}const L=e=>{D.exportApplication(e.id,e.name,d).catch(o=>{o.response.status!==403&&o.response.data.text().then(p=>{ne(`${s("views.application.tip.ExportError")}:${JSON.parse(p).message}`)})})},R=e=>{const o=new FormData;o.append("file",e.raw,e.name),P.value.clearFiles(),D.importApplication(o,d).then(async p=>{p!=null&&p.data&&w()}).catch(p=>{p.code===400&&K(s("common.tip"),s("views.application.tip.professionalMessage"),{cancelButtonText:s("common.confirm"),confirmButtonText:s("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")})})};function G(){q.asyncGetValid(ce.Application,re.Application,d).then(async e=>{e!=null&&e.data?V.value.open():(e==null?void 0:e.code)===400&&K(s("common.tip"),s("views.application.tip.professionalMessage"),{cancelButtonText:s("common.confirm"),confirmButtonText:s("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")})})}function w(){g.userInfo&&localStorage.setItem(g.userInfo.id+"application",b.value),u.value=[],h.current_page=1,h.total=0,H()}function W(e){const o=new URLSearchParams;return e.forEach(p=>{o.append(encodeURIComponent(p.name),encodeURIComponent(p.value))}),o.toString()}function me(e){var p,F,B;(B=(F=(p=u.value.filter(r=>r.id===e)[0])==null?void 0:p.work_flow)==null?void 0:F.nodes)==null||B.filter(r=>r.id==="base-node").map(r=>{c.value=r.properties.api_input_field_list?r.properties.api_input_field_list.map(m=>({name:m.variable,value:m.default_value})):r.properties.input_field_list?r.properties.input_field_list.filter(m=>m.assignment_method==="api_input").map(m=>({name:m.variable,value:m.default_value})):[]});const o=W(c.value)?"?"+W(c.value):"";A.asyncGetAccessToken(e,d).then(r=>{var m;window.open(A.location+((m=r==null?void 0:r.data)==null?void 0:m.access_token)+o)})}function _e(e){d.value=!0,D.getAccessToken(e,d).then(o=>{window.open(`${A.location}${o.data.access_token}?mode=pc-form`,"_blank")}).catch(()=>{ne(s("views.application.tip.ExportError"))})}function fe(e){K(`${s("views.application.delete.confirmTitle")}${e.name} ?`,s("views.application.delete.confirmMessage"),{confirmButtonText:s("common.confirm"),cancelButtonText:s("common.cancel"),confirmButtonClass:"danger"}).then(()=>{D.delApplication(e.id,d).then(()=>{const o=u.value.findIndex(p=>p.id===e.id);u.value.splice(o,1),de(s("common.deleteSuccess"))})}).catch(()=>{})}function H(){const e={...I.value&&{name:I.value},...b.value&&b.value!=="all"&&{select_user_id:b.value}};D.getApplication(h,e,d).then(o=>{o.data.records.forEach(p=>{var F;g.userInfo&&p.user_id===g.userInfo.id?p.username=g.userInfo.username:p.username=(F=U.value.find(B=>B.value===p.user_id))==null?void 0:F.label}),u.value=[...u.value,...o.data.records],h.total=o.data.total})}function ve(){D.getUserList("APPLICATION",d).then(e=>{if(e.data){if(U.value=e.data.map(o=>({label:o.username,value:o.id})),g.userInfo){const o=localStorage.getItem(g.userInfo.id+"application");o&&U.value.find(p=>p.value===o)&&(b.value=o)}H()}})}return Te(()=>{ve()}),(e,o)=>{const p=l("el-option"),F=l("el-select"),B=l("el-input"),r=l("AppIcon"),m=l("el-divider"),ge=l("el-upload"),he=l("el-card"),Y=l("el-col"),Z=l("AppAvatar"),we=l("auto-tooltip"),ye=l("el-text"),X=l("el-tag"),z=l("el-button"),O=l("el-tooltip"),ke=l("MoreFilled"),be=l("el-icon"),j=l("el-dropdown-item"),$e=l("el-dropdown-menu"),Ce=l("el-dropdown"),xe=l("CardBox"),Ae=l("el-row"),Ve=l("InfiniteScroll"),Ie=Ue("loading");return f(),E("div",Ee,[y("div",qe,[y("h4",null,v(e.$t("views.application.title")),1),y("div",Le,[t(F,{modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=a=>b.value=a),class:"mr-12",onChange:w,style:{"max-width":"240px",width:"150px"}},{default:n(()=>[(f(!0),E(oe,null,te(U.value,a=>(f(),C(p,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(B,{modelValue:I.value,"onUpdate:modelValue":o[1]||(o[1]=a=>I.value=a),onChange:w,placeholder:e.$t("views.application.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",style:{"min-width":"240px"},clearable:""},null,8,["modelValue","placeholder"])])]),Be((f(),E("div",null,[t(Ve,{size:u.value.length,total:h.total,page_size:h.page_size,current_page:h.current_page,"onUpdate:current_page":o[6]||(o[6]=a=>h.current_page=a),onLoad:H,loading:d.value},{default:n(()=>[t(Ae,{gutter:15},{default:n(()=>[t(Y,{xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:n(()=>[t(he,{shadow:"hover",class:"application-card-add",style:{"--el-card-padding":"8px"}},{default:n(()=>[y("div",{class:"card-add-button flex align-center cursor p-8",onClick:G},[t(r,{iconName:"app-add-application",class:"mr-8"}),k(" "+v(e.$t("views.application.createApplication")),1)]),t(m,{style:{margin:"8px 0"}}),t(ge,{ref_key:"elUploadRef",ref:P,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(a,ee)=>R(a),class:"card-add-button"},{default:n(()=>[y("div",Ge,[t(r,{iconName:"app-import",class:"mr-8"}),k(" "+v(e.$t("views.application.importApplication")),1)])]),_:1},8,["on-change"])]),_:1})]),_:1}),(f(!0),E(oe,null,te(u.value,(a,ee)=>(f(),C(Y,{xs:24,sm:12,md:8,lg:6,xl:6,key:ee,class:"mb-16"},{default:n(()=>[t(xe,{title:a.name,description:a.desc,class:"application-card cursor",onClick:S=>J(N).push({path:`/application/${a.id}/${a.type}/overview`})},{icon:n(()=>[J(Se)(a==null?void 0:a.icon)?(f(),C(Z,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-8"},{default:n(()=>[y("img",{src:a==null?void 0:a.icon,alt:""},null,8,He)]),_:2},1024)):a!=null&&a.name?(f(),C(Z,{key:1,name:a==null?void 0:a.name,pinyinColor:"",shape:"square",size:32,class:"mr-8"},null,8,["name"])):ae("",!0)]),subTitle:n(()=>[t(ye,{class:"color-secondary",size:"small"},{default:n(()=>[t(we,{content:a.username},{default:n(()=>[k(v(e.$t("common.creator"))+": "+v(a.username),1)]),_:2},1032,["content"])]),_:2},1024)]),footer:n(()=>[y("div",je,[t(O,{effect:"dark",content:e.$t("views.application.setting.demo"),placement:"top"},{default:n(()=>[t(z,{text:"",onClick:[o[2]||(o[2]=x(()=>{},["stop"])),S=>me(a.id)]},{default:n(()=>[t(r,{iconName:"app-view"})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),t(O,{effect:"dark",content:"预览PC表单模式",placement:"top"},{default:n(()=>[t(z,{text:"",onClick:[o[3]||(o[3]=x(()=>{},["stop"])),S=>_e(a.id)]},{default:n(()=>[t(r,{iconName:"app-view"})]),_:2},1032,["onClick"])]),_:2},1024),t(m,{direction:"vertical"}),t(O,{effect:"dark",content:e.$t("common.setting"),placement:"top"},{default:n(()=>[t(z,{text:"",onClick:x(S=>M(a),["stop"])},{default:n(()=>[t(r,{iconName:"Setting"})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),t(m,{direction:"vertical"}),y("span",{onClick:o[5]||(o[5]=x(()=>{},["stop"]))},[t(Ce,{trigger:"click"},{dropdown:n(()=>[t($e,null,{default:n(()=>[$(a)?(f(),C(j,{key:0,onClick:S=>i(a)},{default:n(()=>[t(r,{iconName:"app-copy"}),k(" "+v(e.$t("common.copy")),1)]),_:2},1032,["onClick"])):ae("",!0),t(j,{onClick:x(S=>L(a),["stop"])},{default:n(()=>[t(r,{iconName:"app-export"}),k(" "+v(e.$t("common.export")),1)]),_:2},1032,["onClick"]),t(j,{icon:"Delete",onClick:x(S=>fe(a),["stop"])},{default:n(()=>[k(v(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[t(z,{text:"",onClick:o[4]||(o[4]=x(()=>{},["stop"]))},{default:n(()=>[t(be,null,{default:n(()=>[t(ke)]),_:1})]),_:1})]),_:2},1024)])])]),default:n(()=>[y("div",Oe,[J(Q)(a.type)?(f(),C(X,{key:0,type:"warning",style:{height:"22px"}},{default:n(()=>[k(v(e.$t("views.application.workflow")),1)]),_:1})):(f(),C(X,{key:1,class:"blue-tag",style:{height:"22px"}},{default:n(()=>[k(v(e.$t("views.application.simple")),1)]),_:1}))])]),_:2},1032,["title","description","onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"])])),[[Ie,h.current_page===1&&d.value,void 0,{fullscreen:!0,lock:!0}]]),t(Pe,{ref_key:"CreateApplicationDialogRef",ref:V},null,512),t(ze,{ref_key:"CopyApplicationDialogRef",ref:T},null,512)])}}});const Qe=Me(Je,[["__scopeId","data-v-1ebfa8bf"]]);export{Qe as default};
