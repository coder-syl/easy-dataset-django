# 修复说明 - API 路由匹配问题

## 问题描述

请求 `/api/projects/unmigrated` 时返回 404 错误，错误信息为 "项目不存在"。

## 问题原因

Django 的路由匹配顺序导致 `/api/projects/unmigrated` 被错误地匹配到 `/api/projects/<str:project_id>/` 路由，将 `unmigrated` 当作项目 ID 处理。

## 解决方案

### 1. 调整 Django 路由顺序

已修改 `easy-dataset-django/easy_dataset/urls.py`，将特殊路由（`unmigrated`、`migrate`）放在通用路由（`projects/`）之前：

```python
urlpatterns = [
    path("admin/", admin.site.urls),
    # 将特殊路由放在通用路由之前，避免被 project_id 匹配
    path('api/projects/unmigrated/', include(...)),
    path('api/projects/migrate/', include(...)),
    path('api/projects/', include('projects.urls')),  # 通用路由放在最后
    ...
]
```

### 2. 优化中间件处理尾部斜杠

已更新 `middleware.js`，自动为 API 请求添加尾部斜杠（如果需要），确保与 Django 的路由匹配。

## 测试步骤

1. **重启 Django 后端**：
   ```bash
   cd easy-dataset-django
   python manage.py runserver 0.0.0.0:8000
   ```

2. **测试 API 请求**：
   ```bash
   # 测试 unmigrated 接口
   curl http://127.0.0.1:8000/api/projects/unmigrated/
   # 或
   curl http://127.0.0.1:8000/api/projects/unmigrated
   ```

3. **在前端测试**：
   - 打开浏览器访问 `http://localhost:1717/`
   - 打开开发者工具（F12）
   - 在 Console 中执行：
     ```javascript
     fetch('/api/projects/unmigrated')
       .then(r => r.json())
       .then(data => console.log('响应:', data))
       .catch(err => console.error('错误:', err));
     ```

## 预期结果

- ✅ 请求 `/api/projects/unmigrated` 应该返回未迁移项目列表
- ✅ 响应格式：`{code: 200, message: "Success", data: {...}}`
- ✅ 不再出现 "项目不存在" 错误

## 注意事项

- Django 的路由匹配是**从上到下**的顺序，更具体的路由应该放在更通用的路由之前
- 如果还有其他类似的问题（如 `/api/projects/migrate`），也应该已经修复
- 中间件会自动处理尾部斜杠，所以无论请求是否有尾部斜杠都能正常工作

